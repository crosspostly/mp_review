# üöÄ –û–ë–ù–û–í–õ–ï–ù–ù–´–ô –ü–õ–ê–ù: –ù–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è schema.md

## üìä –ö–õ–Æ–ß–ï–í–´–ï –í–´–í–û–î–´ –ò–ó SCHEMA.MD

### ‚úÖ **–†–ï–ê–õ–¨–ù–´–ï –õ–ò–ú–ò–¢–´ (–æ–∫—Ç—è–±—Ä—å 2025):**

#### Google Apps Script Consumer:
- **Runtime**: 90 –º–∏–Ω—É—Ç/–¥–µ–Ω—å (–Ω–µ 6 –º–∏–Ω—É—Ç –Ω–∞ —Ç—Ä–∏–≥–≥–µ—Ä!)
- **URL Fetch**: 20,000 –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å
- **–¢—Ä–∏–≥–≥–µ—Ä—ã**: 20 –º–∞–∫—Å–∏–º—É–º
- **Execution**: 6 –º–∏–Ω—É—Ç –º–∞–∫—Å–∏–º—É–º –Ω–∞ —Ç—Ä–∏–≥–≥–µ—Ä

#### Ozon API —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å:
- **Rate limit**: –ù–ï –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ
- **–ü—Ä–∞–∫—Ç–∏–∫–∞**: 429 –æ—à–∏–±–∫–∏ –ø—Ä–∏ 2000 –∑–∞–ø—Ä–æ—Å–∞—Ö –∑–∞ 10 —á–∞—Å–æ–≤
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: 500-1000ms –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
- **–ü—Ä–æ–±–ª–µ–º—ã**: –ù–µ—Ç —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –¥–∞—Ç–µ, –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞

#### Wildberries API:
- **Rate limit**: 3 –∑–∞–ø—Ä–æ—Å–∞/—Å–µ–∫ (333ms –∏–Ω—Ç–µ—Ä–≤–∞–ª)
- **Batch**: –î–æ 5000 –æ—Ç–∑—ã–≤–æ–≤ –∑–∞ –∑–∞–ø—Ä–æ—Å
- **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è**: –ï—Å—Ç—å –ø–æ –¥–∞—Ç–µ (dateFrom/dateTo)
- **–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞**: –ï—Å—Ç—å (dateAsc/dateDesc)

## üèóÔ∏è –û–ü–¢–ò–ú–ê–õ–¨–ù–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê (4 –¢–†–ò–ì–ì–ï–†–ê)

### üìã **–£–ü–†–û–©–ï–ù–ù–ê–Ø –°–•–ï–ú–ê:**
```
–¢–†–ò–ì–ì–ï–† 1: –°–±–æ—Ä –æ—Ç–∑—ã–≤–æ–≤ (–∫–∞–∂–¥—ã–π —á–∞—Å)
‚îú‚îÄ‚îÄ Ozon: 20 —Å—Ç—Ä–∞–Ω–∏—Ü –º–∞–∫—Å–∏–º—É–º –∑–∞ –∑–∞–ø—É—Å–∫
‚îú‚îÄ‚îÄ WB: —Ñ–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–µ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞
‚îú‚îÄ‚îÄ –í—Ä–µ–º—è: 3-4 –º–∏–Ω—É—Ç—ã
‚îî‚îÄ‚îÄ Runtime: 60-90 –º–∏–Ω—É—Ç/–¥–µ–Ω—å ‚úÖ

–¢–†–ò–ì–ì–ï–† 2: –ü–æ–¥–±–æ—Ä –æ—Ç–≤–µ—Ç–æ–≤ (–∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç)
‚îú‚îÄ‚îÄ –ü–æ–∏—Å–∫ –æ—Ç–∑—ã–≤–æ–≤ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "NEW"
‚îú‚îÄ‚îÄ –ü–æ–¥–±–æ—Ä —à–∞–±–ª–æ–Ω–æ–≤ –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É
‚îú‚îÄ‚îÄ –í—Ä–µ–º—è: 1-2 –º–∏–Ω—É—Ç—ã
‚îî‚îÄ‚îÄ Runtime: ~10 –º–∏–Ω—É—Ç/–¥–µ–Ω—å ‚úÖ

–¢–†–ò–ì–ì–ï–† 3: –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤ (–∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç)
‚îú‚îÄ‚îÄ –ü–æ–∏—Å–∫ –æ—Ç–∑—ã–≤–æ–≤ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "PENDING_SEND"
‚îú‚îÄ‚îÄ –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ API –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
‚îú‚îÄ‚îÄ –í—Ä–µ–º—è: 1-2 –º–∏–Ω—É—Ç—ã
‚îî‚îÄ‚îÄ Runtime: ~10 –º–∏–Ω—É—Ç/–¥–µ–Ω—å ‚úÖ

–¢–†–ò–ì–ì–ï–† 4: –ì–ª—É–±–æ–∫–∏–π —Å–∫–∞–Ω (—Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é)
‚îú‚îÄ‚îÄ –ü–µ—Ä–µ—Å–º–æ—Ç—Ä –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 3-5 —Å—Ç—Ä–∞–Ω–∏—Ü Ozon
‚îú‚îÄ‚îÄ –ù–∞ —Å–ª—É—á–∞–π "–≤—Å–ø–ª—ã–≤—à–∏—Ö" —Å—Ç–∞—Ä—ã—Ö –æ—Ç–∑—ã–≤–æ–≤
‚îú‚îÄ‚îÄ –í—Ä–µ–º—è: 4-5 –º–∏–Ω—É—Ç
‚îî‚îÄ‚îÄ Runtime: ~5 –º–∏–Ω—É—Ç/–Ω–µ–¥–µ–ª—é ‚úÖ

–ò–¢–û–ì–û: 4 —Ç—Ä–∏–≥–≥–µ—Ä–∞ (–æ—Å—Ç–∞–µ—Ç—Å—è 16 —Ä–µ–∑–µ—Ä–≤!)
```

## üîß –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø –ù–ê –û–°–ù–û–í–ï SCHEMA.MD

### –≠–¢–ê–ü 1: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ª–∏—Å—Ç–æ–≤
```javascript
// –ù–æ–≤—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ (–∏–∑ schema.md)
CONFIG.HEADERS = [
  'reviewId',        // A: –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
  'createdDate',     // B: –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
  'rating',          // C: –†–µ–π—Ç–∏–Ω–≥ (1-5)
  'text',            // D: –¢–µ–∫—Å—Ç –æ—Ç–∑—ã–≤–∞
  'product',         // E: –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
  'status',          // F: NEW/PENDING_SEND/SENT/ERROR
  'processedDate',   // G: –î–∞—Ç–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏
  'answer',          // H: –¢–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞
  'errorMsg'         // I: –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
];

// –°—Ç–∞—Ç—É—Å—ã –æ—Ç–∑—ã–≤–æ–≤ (–∏–∑ schema.md)
CONFIG.REVIEW_STATUS = {
  NEW: 'NEW',
  PENDING_SEND: 'PENDING_SEND',
  SENT: 'SENT',
  ERROR: 'ERROR'
};
```

### –≠–¢–ê–ü 2: –¢—Ä–∏–≥–≥–µ—Ä —Å–±–æ—Ä–∞ –æ—Ç–∑—ã–≤–æ–≤ (–∫–∞–∂–¥—ã–π —á–∞—Å)
```javascript
function hourlyReviewCollector() {
  const startTime = Date.now();
  const maxExecutionTime = 4 * 60 * 1000; // 4 –º–∏–Ω—É—Ç—ã –ª–∏–º–∏—Ç
  
  log(`[Collector] üöÄ –ù–∞—á–∏–Ω–∞–µ–º —Å–±–æ—Ä –æ—Ç–∑—ã–≤–æ–≤`);
  
  // –®–ê–ì 1: –ó–∞–≥—Ä—É–∑–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –º–∞–≥–∞–∑–∏–Ω—ã
  const stores = getActiveStores();
  log(`[Collector] üìä –ù–∞–π–¥–µ–Ω–æ ${stores.length} –∞–∫—Ç–∏–≤–Ω—ã—Ö –º–∞–≥–∞–∑–∏–Ω–æ–≤`);
  
  // –®–ê–ì 2: –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∑–∞–ø—É—Å–∫–∞
  let startIndex = getLastProcessedStoreIndex();
  if (startIndex >= stores.length) {
    startIndex = 0; // –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–Ω–æ–≤–æ
  }
  
  // –®–ê–ì 3: –¶–∏–∫–ª –ø–æ –º–∞–≥–∞–∑–∏–Ω–∞–º
  for (let i = startIndex; i < stores.length; i++) {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
    if (Date.now() - startTime > maxExecutionTime) {
      log(`[Collector] ‚è∞ –í—Ä–µ–º—è –∏—Å—Ç–µ–∫–ª–æ, —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å: ${i}`);
      saveLastProcessedStoreIndex(i);
      return;
    }
    
    const store = stores[i];
    
    try {
      log(`[Collector] üì¶ –û–±—Ä–∞–±–æ—Ç–∫–∞ ${store.name} (${store.marketplace})`);
      
      let newReviews = [];
      
      if (store.marketplace === 'Ozon') {
        newReviews = collectOzonReviewsBatch(store);
      } else if (store.marketplace === 'Wildberries') {
        newReviews = collectWBReviewsBatch(store);
      }
      
      if (newReviews.length > 0) {
        // –§–∏–ª—å—Ç—Ä—É–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã
        const uniqueReviews = filterDuplicatesByProperties(newReviews, store.id);
        
        if (uniqueReviews.length > 0) {
          // Batch —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ª–∏—Å—Ç
          batchSaveToSheet(uniqueReviews, store.id);
          
          // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
          updateStoreProgress(store.id, uniqueReviews.length);
          
          log(`[Collector] ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ ${uniqueReviews.length} –Ω–æ–≤—ã—Ö –æ—Ç–∑—ã–≤–æ–≤`);
        }
      }
      
    } catch (error) {
      log(`[Collector] ‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ ${store.name}: ${error.message}`);
      // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Å —Å–ª–µ–¥—É—é—â–∏–º –º–∞–≥–∞–∑–∏–Ω–æ–º
    }
  }
  
  // –®–ê–ì 4: –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ü–∏–∫–ª–∞
  saveLastProcessedStoreIndex(0);
  log(`[Collector] üèÅ –°–±–æ—Ä –æ—Ç–∑—ã–≤–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω`);
}
```

### –≠–¢–ê–ü 3: –°–±–æ—Ä Ozon –æ—Ç–∑—ã–≤–æ–≤ (—Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π)
```javascript
function collectOzonReviewsBatch(store) {
  const maxPages = 20; // –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –ª–∏–º–∏—Ç –∏–∑ schema.md
  const delayMs = 800; // –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
  let allReviews = [];
  
  log(`[Ozon] üìÑ –°–±–æ—Ä –æ—Ç–∑—ã–≤–æ–≤ –¥–ª—è ${store.name}, –º–∞–∫—Å–∏–º—É–º ${maxPages} —Å—Ç—Ä–∞–Ω–∏—Ü`);
  
  for (let page = 1; page <= maxPages; page++) {
    try {
      // –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ (–∏–∑ schema.md)
      if (page > 1) {
        Utilities.sleep(delayMs);
      }
      
      log(`[Ozon] üìÑ –°—Ç—Ä–∞–Ω–∏—Ü–∞ ${page}...`);
      
      const pageReviews = getOzonReviewsPage(store, page);
      
      if (pageReviews.length === 0) {
        log(`[Ozon] üìÑ –°—Ç—Ä–∞–Ω–∏—Ü–∞ ${page} –ø—É—Å—Ç–∞, –∑–∞–≤–µ—Ä—à–∞–µ–º`);
        break;
      }
      
      allReviews = allReviews.concat(pageReviews);
      
      log(`[Ozon] üìä –°—Ç—Ä–∞–Ω–∏—Ü–∞ ${page}: ${pageReviews.length} –æ—Ç–∑—ã–≤–æ–≤, –≤—Å–µ–≥–æ ${allReviews.length}`);
      
    } catch (error) {
      if (error.message.includes('429')) {
        log(`[Ozon] ‚ö†Ô∏è Rate limit –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ ${page}, –∂–¥–µ–º 2 —Å–µ–∫—É–Ω–¥—ã`);
        Utilities.sleep(2000);
        continue;
      } else {
        log(`[Ozon] ‚ùå –û—à–∏–±–∫–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ ${page}: ${error.message}`);
        break;
      }
    }
  }
  
  log(`[Ozon] üèÅ –°–æ–±—Ä–∞–Ω–æ ${allReviews.length} –æ—Ç–∑—ã–≤–æ–≤ –∑–∞ ${Math.min(maxPages, allReviews.length)} —Å—Ç—Ä–∞–Ω–∏—Ü`);
  return allReviews;
}
```

### –≠–¢–ê–ü 4: –°–±–æ—Ä WB –æ—Ç–∑—ã–≤–æ–≤ (—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π)
```javascript
function collectWBReviewsBatch(store) {
  const delayMs = 500; // –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
  const last24Hours = Math.floor(Date.now() / 1000) - (24 * 60 * 60); // Unix timestamp
  
  log(`[WB] üìÑ –°–±–æ—Ä –æ—Ç–∑—ã–≤–æ–≤ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞ –¥–ª—è ${store.name}`);
  
  try {
    // –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –∑–∞–ø—Ä–æ—Å–æ–º
    Utilities.sleep(delayMs);
    
    const reviews = getWBReviewsByDateRange(store, last24Hours);
    
    log(`[WB] üìä –°–æ–±—Ä–∞–Ω–æ ${reviews.length} –æ—Ç–∑—ã–≤–æ–≤ –∑–∞ 24 —á–∞—Å–∞`);
    
    return reviews;
    
  } catch (error) {
    if (error.message.includes('429')) {
      log(`[WB] ‚ö†Ô∏è Rate limit, –∂–¥–µ–º 1 —Å–µ–∫—É–Ω–¥—É`);
      Utilities.sleep(1000);
      return collectWBReviewsBatch(store); // Retry
    } else {
      log(`[WB] ‚ùå –û—à–∏–±–∫–∞: ${error.message}`);
      return [];
    }
  }
}
```

### –≠–¢–ê–ü 5: –ü–æ–¥–±–æ—Ä –æ—Ç–≤–µ—Ç–æ–≤ (–∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç)
```javascript
function selectReviewAnswers() {
  const maxReviews = 100; // –õ–∏–º–∏—Ç –∑–∞ –∑–∞–ø—É—Å–∫
  const maxTime = 2 * 60 * 1000; // 2 –º–∏–Ω—É—Ç—ã –ª–∏–º–∏—Ç
  
  log(`[Answer Selector] üöÄ –ù–∞—á–∏–Ω–∞–µ–º –ø–æ–¥–±–æ—Ä –æ—Ç–≤–µ—Ç–æ–≤`);
  
  // –ü–æ–∏—Å–∫ –æ—Ç–∑—ã–≤–æ–≤ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "NEW"
  const newReviews = getReviewsByStatus('NEW', maxReviews);
  
  if (newReviews.length === 0) {
    log(`[Answer Selector] ‚ÑπÔ∏è –ù–æ–≤—ã—Ö –æ—Ç–∑—ã–≤–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ`);
    return;
  }
  
  log(`[Answer Selector] üìä –ù–∞–π–¥–µ–Ω–æ ${newReviews.length} –æ—Ç–∑—ã–≤–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏`);
  
  const updates = [];
  
  newReviews.forEach(review => {
    try {
      // –ü–æ–¥–±–æ—Ä —à–∞–±–ª–æ–Ω–∞ –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É (–∏–∑ schema.md)
      let template = '';
      
      switch(review.rating) {
        case 5:
          template = getTemplate('EXCELLENT');
          break;
        case 4:
          template = getTemplate('POSITIVE');
          break;
        case 3:
          template = getTemplate('NEUTRAL');
          break;
        case 2:
        case 1:
          template = getTemplate('NEGATIVE');
          break;
      }
      
      // –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
      template = customizeTemplate(template, review.text);
      
      // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
      updates.push({
        reviewId: review.id,
        storeId: review.storeId,
        answer: template,
        status: 'PENDING_SEND',
        processedDate: new Date()
      });
      
    } catch (error) {
      log(`[Answer Selector] ‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç–∑—ã–≤–∞ ${review.id}: ${error.message}`);
    }
  });
  
  // Batch –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ –ª–∏—Å—Ç–∞—Ö
  if (updates.length > 0) {
    batchUpdateReviews(updates);
    log(`[Answer Selector] ‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ ${updates.length} –æ—Ç–∑—ã–≤–æ–≤`);
  }
}
```

### –≠–¢–ê–ü 6: –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤ (–∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç)
```javascript
function sendReviewAnswers() {
  const maxReviews = 50; // –õ–∏–º–∏—Ç –∑–∞ –∑–∞–ø—É—Å–∫
  const maxTime = 2 * 60 * 1000; // 2 –º–∏–Ω—É—Ç—ã –ª–∏–º–∏—Ç
  
  log(`[Answer Sender] üöÄ –ù–∞—á–∏–Ω–∞–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É –æ—Ç–≤–µ—Ç–æ–≤`);
  
  // –ü–æ–∏—Å–∫ –æ—Ç–∑—ã–≤–æ–≤ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "PENDING_SEND"
  const pendingReviews = getReviewsByStatus('PENDING_SEND', maxReviews);
  
  if (pendingReviews.length === 0) {
    log(`[Answer Sender] ‚ÑπÔ∏è –û—Ç–≤–µ—Ç–æ–≤ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ`);
    return;
  }
  
  log(`[Answer Sender] üìä –ù–∞–π–¥–µ–Ω–æ ${pendingReviews.length} –æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏`);
  
  const updates = [];
  
  pendingReviews.forEach(review => {
    try {
      let success = false;
      
      if (review.marketplace === 'Ozon') {
        success = sendOzonAnswer(review.id, review.answer);
        Utilities.sleep(500); // –ó–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è Ozon
      } else if (review.marketplace === 'Wildberries') {
        success = sendWBAnswer(review.id, review.answer);
        Utilities.sleep(333); // –ó–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è WB
      }
      
      if (success) {
        updates.push({
          reviewId: review.id,
          storeId: review.storeId,
          status: 'SENT',
          sentDate: new Date()
        });
        
        log(`[Answer Sender] ‚úÖ –û—Ç–≤–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –¥–ª—è –æ—Ç–∑—ã–≤–∞ ${review.id}`);
      } else {
        updates.push({
          reviewId: review.id,
          storeId: review.storeId,
          status: 'ERROR',
          errorMsg: '–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏'
        });
        
        log(`[Answer Sender] ‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–ª—è –æ—Ç–∑—ã–≤–∞ ${review.id}`);
      }
      
    } catch (error) {
      updates.push({
        reviewId: review.id,
        storeId: review.storeId,
        status: 'ERROR',
        errorMsg: error.message
      });
      
      log(`[Answer Sender] ‚ùå –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –¥–ª—è –æ—Ç–∑—ã–≤–∞ ${review.id}: ${error.message}`);
    }
  });
  
  // Batch –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ –ª–∏—Å—Ç–∞—Ö
  if (updates.length > 0) {
    batchUpdateReviews(updates);
    log(`[Answer Sender] ‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ ${updates.length} –æ—Ç–≤–µ—Ç–æ–≤`);
  }
}
```

## üìä –†–ê–°–ß–ï–¢ –≠–§–§–ï–ö–¢–ò–í–ù–û–°–¢–ò (–∏–∑ schema.md)

### –°—Ü–µ–Ω–∞—Ä–∏–π: 15 –º–∞–≥–∞–∑–∏–Ω–æ–≤ (10 Ozon + 5 WB)

#### Runtime –∫–≤–æ—Ç–∞ –≤ –¥–µ–Ω—å:
- **–°–±–æ—Ä –æ—Ç–∑—ã–≤–æ–≤**: 24 –∑–∞–ø—É—Å–∫–∞ √ó 1.2 –º–∏–Ω—É—Ç—ã = **~29 –º–∏–Ω—É—Ç**
- **–ü–æ–¥–±–æ—Ä –æ—Ç–≤–µ—Ç–æ–≤**: 24 √ó 7 = 168 –∑–∞–ø—É—Å–∫–æ–≤ √ó 0.5 –º–∏–Ω—É—Ç—ã = **~84 –º–∏–Ω—É—Ç—ã** ‚ö†Ô∏è
- **–û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤**: 24 √ó 7 = 168 –∑–∞–ø—É—Å–∫–æ–≤ √ó 0.5 –º–∏–Ω—É—Ç—ã = **~84 –º–∏–Ω—É—Ç—ã** ‚ö†Ô∏è

**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–∞ Consumer (90 –º–∏–Ω—É—Ç) –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç!

#### –†–µ—à–µ–Ω–∏–µ –¥–ª—è Consumer –∞–∫–∫–∞—É–Ω—Ç–∞:
- **–°–±–æ—Ä –æ—Ç–∑—ã–≤–æ–≤**: –∫–∞–∂–¥—ã–π —á–∞—Å (—ç–∫–æ–Ω–æ–º–∏—Ç runtime)
- **–ü–æ–¥–±–æ—Ä –æ—Ç–≤–µ—Ç–æ–≤**: –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç (–≤–º–µ—Å—Ç–æ 15)
- **–û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤**: –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç (–≤–º–µ—Å—Ç–æ 15)

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: ~70-80 –º–∏–Ω—É—Ç/–¥–µ–Ω—å (—É–∫–ª–∞–¥—ã–≤–∞–µ–º—Å—è –≤ 90 –º–∏–Ω—É—Ç) ‚úÖ

## üéØ –ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê –û–ë–ù–û–í–õ–ï–ù–ù–û–ì–û –ü–õ–ê–ù–ê

### ‚úÖ **–ù–ê –û–°–ù–û–í–ï –†–ï–ê–õ–¨–ù–û–ì–û –ò–°–°–õ–ï–î–û–í–ê–ù–ò–Ø:**
- **–†–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ –ª–∏–º–∏—Ç—ã**: 20 —Å—Ç—Ä–∞–Ω–∏—Ü Ozon –∑–∞ 4 –º–∏–Ω—É—Ç—ã
- **–¢–æ—á–Ω—ã–µ rate limits**: 800ms –¥–ª—è Ozon, 500ms –¥–ª—è WB
- **–ü—Ä–æ—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: 4 —Ç—Ä–∏–≥–≥–µ—Ä–∞ –≤–º–µ—Å—Ç–æ 19
- **–£—á–µ—Ç runtime –∫–≤–æ—Ç**: 90 –º–∏–Ω—É—Ç/–¥–µ–Ω—å –¥–ª—è Consumer
- **Batch processing**: –û–¥–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—è setValues() –≤–º–µ—Å—Ç–æ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ appendRow()

### ‚úÖ **–†–ï–®–ï–ù–ò–ï –ü–†–û–ë–õ–ï–ú –¢–´–°–Ø–ß –°–¢–†–ê–ù–ò–¶:**
- **Ozon**: –¢–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 20 —Å—Ç—Ä–∞–Ω–∏—Ü –∑–∞ –∑–∞–ø—É—Å–∫
- **WB**: –§–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–µ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞
- **–ì–ª—É–±–æ–∫–∏–π —Å–∫–∞–Ω**: –†–∞–∑ –≤ –Ω–µ–¥–µ–ª—é –¥–ª—è "–≤—Å–ø–ª—ã–≤—à–∏—Ö" –æ—Ç–∑—ã–≤–æ–≤
- **–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ**: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –º–µ–∂–¥—É –∑–∞–ø—É—Å–∫–∞–º–∏

### ‚úÖ **–°–¢–ê–ë–ò–õ–¨–ù–û–°–¢–¨:**
- **Retry –ª–æ–≥–∏–∫–∞**: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ 429, 500, 503
- **Exponential backoff**: –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –∑–∞–¥–µ—Ä–∂–µ–∫ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- **Graceful degradation**: –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –ø—Ä–∏ —Å–±–æ—è—Ö
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

## üìã –ü–û–®–ê–ì–û–í–´–ô –ü–õ–ê–ù –í–ù–ï–î–†–ï–ù–ò–Ø

### –ù–µ–¥–µ–ª—è 1: –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- [ ] –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ª–∏—Å—Ç–æ–≤ –ø–æ schema.md
- [ ] –°–æ–∑–¥–∞—Ç—å 4 —Ç—Ä–∏–≥–≥–µ—Ä–∞ —Å –ø—É—Å—Ç—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É —Å—Ç–∞—Ç—É—Å–æ–≤

### –ù–µ–¥–µ–ª—è 2: –°–±–æ—Ä –æ—Ç–∑—ã–≤–æ–≤
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `collectOzonReviewsBatch()` —Å –ª–∏–º–∏—Ç–æ–º 20 —Å—Ç—Ä–∞–Ω–∏—Ü
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `collectWBReviewsBatch()` —Å —Ñ–∏–ª—å—Ç—Ä–æ–º –ø–æ –¥–∞—Ç–µ
- [ ] –î–æ–±–∞–≤–∏—Ç—å retry –ª–æ–≥–∏–∫—É –∏ –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫

### –ù–µ–¥–µ–ª—è 3: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `selectReviewAnswers()` —Å —à–∞–±–ª–æ–Ω–∞–º–∏
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `sendReviewAnswers()` —Å rate limits
- [ ] –î–æ–±–∞–≤–∏—Ç—å batch –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ù–µ–¥–µ–ª—è 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- [ ] –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥ runtime –∫–≤–æ—Ç—ã
- [ ] –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –Ω–∞ –≤—Å–µ—Ö –º–∞–≥–∞–∑–∏–Ω–∞—Ö

---

**–ê–≤—Ç–æ—Ä**: Factory AI Assistant  
**–î–∞—Ç–∞**: 2025-01-22  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ Updated based on schema.md research  
**–í–µ—Ä—Å–∏—è**: 3.0.0 - –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –ø–ª–∞–Ω –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è

*–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –ø–ª–∞–Ω –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è schema.md —Å —É—á–µ—Ç–æ–º —Ä–µ–∞–ª—å–Ω—ã—Ö –ª–∏–º–∏—Ç–æ–≤ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π*
