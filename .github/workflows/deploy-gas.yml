name: ğŸš€ Deploy to Google Apps Script

on:
  push:
    branches: [ main ]
    paths:
      - 'refactor/**'
      - 'appsscript.json'
      - '.clasp.json'
  workflow_dispatch:

jobs:
  deploy:
    name: ğŸš€ Deploy to GAS
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout ĞºĞ¾Ğ´Ğ°
      uses: actions/checkout@v4
      
    - name: ğŸ”§ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    - name: ğŸ“¦ Install clasp
      run: |
        npm install -g @google/clasp
        echo "âœ… clasp ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½"
        clasp --version
        
    - name: ğŸ”‘ Setup clasp credentials
      run: |
        echo "ğŸ”‘ ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° credentials..."
        
        # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ´Ğ»Ñ credentials
        mkdir -p ~/.clasprc.json
        
        # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ .clasprc.json Ğ¸Ğ· ÑĞµĞºÑ€ĞµÑ‚Ğ°
        echo '${{ secrets.CLASP_CREDENTIALS }}' > ~/.clasprc.json
        
        echo "âœ… Credentials Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ñ‹"
        
    - name: ğŸ“‹ Verify configuration
      run: |
        echo "ğŸ“‹ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸..."
        
        if [ ! -f ".clasp.json" ]; then
          echo "âŒ .clasp.json Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½!"
          exit 1
        fi
        
        if [ ! -f "appsscript.json" ]; then
          echo "âŒ appsscript.json Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½!"
          exit 1
        fi
        
        echo "âœ… ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ°"
        cat .clasp.json
        
    - name: ğŸ“¤ Push to Google Apps Script
      run: |
        echo "ğŸ“¤ Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ² Google Apps Script..."
        
        # Push Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹
        clasp push --force
        
        echo "âœ… ĞšĞ¾Ğ´ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½ Ğ² Google Apps Script!"
        
    - name: ğŸ“Š Deployment info
      run: |
        echo "ğŸ“Š ===== Ğ˜ĞĞ¤ĞĞ ĞœĞĞ¦Ğ˜Ğ¯ Ğ Ğ”Ğ•ĞŸĞ›ĞĞ• ====="
        echo "ğŸ• Ğ’Ñ€ĞµĞ¼Ñ: $(date)"
        echo "ğŸ“ ĞšĞ¾Ğ¼Ğ¼Ğ¸Ñ‚: ${{ github.sha }}"
        echo "ğŸ‘¤ ĞĞ²Ñ‚Ğ¾Ñ€: ${{ github.actor }}"
        echo "ğŸŒ¿ Ğ’ĞµÑ‚ĞºĞ°: ${{ github.ref_name }}"
        echo "ğŸ¯ Script ID: $(grep scriptId .clasp.json | cut -d'"' -f4)"
        echo "âœ… Ğ”ĞµĞ¿Ğ»Ğ¾Ğ¹ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾!"
