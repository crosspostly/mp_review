# –ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –∞–≤—Ç–æ–æ—Ç–≤–µ—Ç–æ–≤ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Ozon –∏ WB

## –ü—Ä–æ–±–ª–µ–º–∞
API Ozon –Ω–µ —Å–æ—Ä—Ç–∏—Ä—É–µ—Ç –æ—Ç–∑—ã–≤—ã –ø–æ –¥–∞—Ç–µ ‚Üí —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ —Å–ª—É—á–∞–π–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ ‚Üí –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –æ—Ç–∑—ã–≤–æ–≤ (–¥–µ—Å—è—Ç–∫–∏ —Ç—ã—Å—è—á) –ø–æ–ª–Ω—ã–π –ø–µ—Ä–µ—Å–∫–∞–Ω –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–º.

## –†–µ—à–µ–Ω–∏–µ: 3-—É—Ä–æ–≤–Ω–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

**–¢–†–ò–ì–ì–ï–† 1: –°–±–æ—Ä –æ—Ç–∑—ã–≤–æ–≤** (–∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç)
- WB: –ø—Ä–æ—Å—Ç–æ–π —Å–±–æ—Ä –Ω–æ–≤—ã—Ö –æ—Ç–∑—ã–≤–æ–≤
- Ozon: –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–±–æ—Ä —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –ø–æ –ª–∏—Å—Ç—É
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ª–∏—Å—Ç—ã –º–∞–≥–∞–∑–∏–Ω–æ–≤ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `NEW`

**–¢–†–ò–ì–ì–ï–† 2: –ü–æ–¥–±–æ—Ä –æ—Ç–≤–µ—Ç–æ–≤** (–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç)
- –ü–æ–∏—Å–∫ –æ—Ç–∑—ã–≤–æ–≤ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `NEW`
- –ü–æ–¥–±–æ—Ä —à–∞–±–ª–æ–Ω–æ–≤ –æ—Ç–≤–µ—Ç–æ–≤
- –°–º–µ–Ω–∞ —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞ `PROCESSED`

**–¢–†–ò–ì–ì–ï–† 3: –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤** (–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç)
- –ü–æ–∏—Å–∫ –æ—Ç–∑—ã–≤–æ–≤ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `PROCESSED`
- –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ API –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞
- –°–º–µ–Ω–∞ —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞ `SENT`

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–∏—Å—Ç–æ–≤ –º–∞–≥–∞–∑–∏–Ω–æ–≤

| –ö–æ–ª–æ–Ω–∫–∞ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---------|-----------|
| A | ID –æ—Ç–∑—ã–≤–∞ |
| B | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |
| C | –†–µ–π—Ç–∏–Ω–≥ |
| D | –¢–µ–∫—Å—Ç –æ—Ç–∑—ã–≤–∞ |
| E | –¢–æ–≤–∞—Ä |
| F | –°—Ç–∞—Ç—É—Å (NEW/PROCESSED/SENT/ERROR) |
| G | –î–∞—Ç–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ |
| H | –û—Ç–≤–µ—Ç |
| I | –û—à–∏–±–∫–∞ |

### –•—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

**–í ScriptProperties** (–º–∏–Ω–∏–º—É–º –¥–∞–Ω–Ω—ã—Ö):
```json
{
  "lastPage": 15,
  "lastCollection": "2025-10-22T20:30:00Z",
  "strategy": "incremental"
}
```

**–í –ª–∏—Å—Ç–∞—Ö**: –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç–∑—ã–≤–æ–≤ + —Å—Ç–∞—Ç—É—Å—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏

### –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Å–±–æ—Ä–∞ –¥–ª—è Ozon

1. **–ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π** (–∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç): —Å–æ–±–∏—Ä–∞–µ–º —Å –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
2. **–ü–æ–ª–Ω—ã–π —Å–∫–∞–Ω** (–µ—Å–ª–∏ –ø—Ä–æ—à–ª–æ >6 —á–∞—Å–æ–≤): –ø–æ–ª–Ω—ã–π –ø–µ—Ä–µ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü —Å –Ω–∞—á–∞–ª–∞
3. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤**: –ø—Ä–æ–≤–µ—Ä–∫–∞ ID –æ—Ç–∑—ã–≤–æ–≤ –ø—Ä–æ—Ç–∏–≤ –¥–∞–Ω–Ω—ã—Ö –≤ –ª–∏—Å—Ç–µ

## –≠—Ç–∞–ø—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –®–ê–ì 1: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≤ code.gs
1. –ò–∑–º–µ–Ω–∏—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏ –ª–∏—Å—Ç–æ–≤ –≤ CONFIG
2. –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã —Å—Ç–∞—Ç—É—Å–æ–≤
3. –û–±–Ω–æ–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `createOrGetSheet`

### –®–ê–ì 2: –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤ –≤ code.gs
1. `processReviewsCollection()` ‚Äî —Å–±–æ—Ä –æ—Ç–∑—ã–≤–æ–≤ WB + Ozon
2. `processReviewAnswers()` ‚Äî –ø–æ–¥–±–æ—Ä –æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è –≤—Å–µ—Ö –º–∞–≥–∞–∑–∏–Ω–æ–≤
3. `processReviewSending()` ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è –≤—Å–µ—Ö –º–∞–≥–∞–∑–∏–Ω–æ–≤

### –®–ê–ì 3: –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è ozon_functions.gs
1. –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å `getOzonFeedbacksWithAdaptivePagination` ‚Üí `getOzonReviews`
2. –î–æ–±–∞–≤–∏—Ç—å `filterDuplicatesBySheet()` ‚Äî —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
3. –î–æ–±–∞–≤–∏—Ç—å `saveReviewsToSheet()` ‚Äî —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ —Å—Ç–∞—Ç—É—Å–∞–º–∏
4. –î–æ–±–∞–≤–∏—Ç—å `getCollectionStrategy()` ‚Äî –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Å–±–æ—Ä–∞

### –®–ê–ì 4: –°–æ–∑–¥–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è WB –≤ api_fixes.gs
1. `processWbReviews()` ‚Äî –ø—Ä–æ—Å—Ç–æ–π —Å–±–æ—Ä WB –æ—Ç–∑—ã–≤–æ–≤
2. `getWbReviews()` ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å–±–æ—Ä–∞
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç—É –∂–µ —Å–∏—Å—Ç–µ–º—É —Å—Ç–∞—Ç—É—Å–æ–≤

### –®–ê–ì 5: –û–±—â–∏–µ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ code.gs
1. `updateReviewStatus()` ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –æ—Ç–∑—ã–≤–∞
2. `getReviewsByStatus()` ‚Äî –≤—ã–±–æ—Ä–∫–∞ –æ—Ç–∑—ã–≤–æ–≤ –ø–æ —Å—Ç–∞—Ç—É—Å—É
3. `sendAnswerToReview()` ‚Äî —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ (WB/Ozon)

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–µ—à–µ–Ω–∏—è

‚úÖ **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å**: –Ω–µ —Å–∫–∞–Ω–∏—Ä—É–µ–º –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∫–∞–∂–¥—ã–π —Ä–∞–∑  
‚úÖ **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: –≤—Å–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö  
‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è 10-20+ –º–∞–≥–∞–∑–∏–Ω–æ–≤  
‚úÖ **–û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å**: –∫–∞–∂–¥—ã–π —ç—Ç–∞–ø –Ω–µ–∑–∞–≤–∏—Å–∏–º  
‚úÖ **–£–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è –≤ 6 –º–∏–Ω—É—Ç**: –∫–∞–∂–¥—ã–π —Ç—Ä–∏–≥–≥–µ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ—é —á–∞—Å—Ç—å  
‚úÖ **–ù–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤**: –ø—Ä–æ–≤–µ—Ä–∫–∞ ID –ø–æ –ª–∏—Å—Ç—É  
‚úÖ **–ù–µ—Ç –ø–æ—Ç–µ—Ä—å**: –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–±–æ—Ä + –ø–æ–ª–Ω—ã–π —Å–∫–∞–Ω —Ä–∞–∑ –≤ 6 —á–∞—Å–æ–≤

## –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∫–æ–¥–∞

- **code.gs**: —Ç—Ä–∏–≥–≥–µ—Ä—ã, –æ–±—â–∞—è –ª–æ–≥–∏–∫–∞, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞–º–∏
- **ozon_functions.gs**: —Ç–æ–ª—å–∫–æ —Ä–∞–±–æ—Ç–∞ —Å Ozon API
- **api_fixes.gs**: —Ç–æ–ª—å–∫–æ —Ä–∞–±–æ—Ç–∞ —Å WB API

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –º–∞–≥–∞–∑–∏–Ω Ozon
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–±–æ—Ä –æ—Ç–∑—ã–≤–æ–≤
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–º–µ–Ω—É —Å—Ç–∞—Ç—É—Å–æ–≤
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –æ—Ç–≤–µ—Ç–æ–≤
6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å 10+ –º–∞–≥–∞–∑–∏–Ω–∞–º–∏
 

–≤–æ—Ç —Å —ç—Ç–∏–º –±—ã –µ—â—ë –≤–æ–ø—Ä–æ—Å–∏–∫–∏ —Ä–µ—à–∏—Ç—å!
"–ö–∞–∫–∞—è –¥–∏–ª–ª–µ–º–∞, –∫–æ—Ç–æ—Ä—É—é –Ω–∞–¥–æ —Ä–µ—à–∏—Ç—å:
–ú–µ—Ç–æ–¥ –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–∑—ã–≤–æ–≤ –≤ API Ozon –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω–µ —Å–æ—Ä—Ç–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å—Ç—Ä–æ–≥–æ –ø–æ –¥–∞—Ç–µ. –°–æ–≥–ª–∞—Å–Ω–æ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏ –æ—Ç–∑—ã–≤–∞–º —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –≤ –º–µ—Ç–æ–¥–µ /v1/review/list –∏–º–µ–µ—Ç –Ω–µ–æ—á–µ–≤–∏–¥–Ω—É—é –ª–æ–≥–∏–∫—É, —á—Ç–æ –æ–±—ä—è—Å–Ω—è–µ—Ç ¬´—Å–ø—É—Ç–∞–Ω–Ω—ã–π¬ª –ø–æ—Ä—è–¥–æ–∫ –≤—ã–≤–æ–¥–∞ –æ—Ç–∑—ã–≤–æ–≤.ozon+2‚Äã


–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤—ã–¥–∞—á–∞ /v1/review/list
–ú–µ—Ç–æ–¥ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∞—Å—Å–∏–≤ –æ—Ç–∑—ã–≤–æ–≤, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π ID, —Ä–µ–π—Ç–∏–Ω–≥, —Ç–µ–∫—Å—Ç –∏ –¥—Ä—É–≥–∏–µ –ø–æ–ª—è, –Ω–æ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä order –∏–ª–∏ —è–≤–Ω—É—é —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É –ø–æ –¥–∞—Ç–µ. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å—Å—è:
–ø–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º—É –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—É –æ—Ç–∑—ã–≤–∞ (UUID), –∞ –Ω–µ –ø–æ datetime ;ozon‚Äã
–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ —Ç–∞–±–ª–∏—Ü Ozon Feedback Service, –≥–¥–µ –ø–æ—Ä—è–¥–æ–∫ —á–∞—Å—Ç–æ –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å created_at.paste.txt‚Äã
–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –ø—Ä–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫—É –ø–æ—Ä—è–¥–∫–∞ ‚Äî API –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—É—é —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É.
–ß—Ç–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏
–ù–∞ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–º —Ñ–æ—Ä—É–º–µ Ozon for Dev (–≤ –≤–µ—Ç–∫–µ ¬´–ù–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–æ–≤—ã–µ –æ—Ç–∑—ã–≤—ã¬ª) –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∂–∞–ª—É—é—Ç—Å—è, —á—Ç–æ –º–µ—Ç–æ–¥ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ä—ã–µ –æ—Ç–∑—ã–≤—ã –≤ –Ω–∞—á–∞–ª–µ, –¥–∞–∂–µ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –Ω–æ–≤—ã—Ö –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Ozon –æ—Ç–≤–µ—á–∞–µ—Ç, —á—Ç–æ ¬´–º–µ—Ç–æ–¥ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–∑—ã–≤—ã –≤ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ –±–µ–∑ –≥–∞—Ä–∞–Ω—Ç–∏–∏ —Å–≤–µ–∂–µ—Å—Ç–∏¬ª. –°–æ–æ–±—â–µ—Å—Ç–≤–æ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–ª–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ –¥–∞—Ç–µ –≤—Ä—É—á–Ω—É—é ‚Äî —á–µ—Ä–µ–∑ –ø–æ–ª—è from / to, –Ω–æ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –≤—Å—ë —Ä–∞–≤–Ω–æ –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–µ—Å—Ç—Ä–æ–≥–æ–π.ozon‚Äã
–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
–°–æ–≥–ª–∞—Å–Ω–æ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–º –º–µ—Ç–æ–¥–∞–º Seller API :t+1‚Äã
/v1/review/list –Ω–µ –∏–º–µ–µ—Ç –ø–æ–ª—è sort_field –∏–ª–∏ sort_direction.
–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Ö—Ä–∞–Ω–∏—Ç—å —É —Å–µ–±—è last_review_id –∏ –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–∏—Ö –∏—Ç–µ—Ä–∞—Ü–∏—è—Ö –≤—ã–±–∏—Ä–∞—Ç—å –æ—Ç–∑—ã–≤—ã —Ç–æ–ª—å–∫–æ —Å –±–æ–ª–µ–µ –Ω–æ–≤—ã–º–∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞–º–∏.
–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ç–æ—Ä—ã —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–æ –≤—ã—è–≤–∏–ª–∏, —á—Ç–æ –±–æ–ª–µ–µ –Ω–æ–≤—ã–µ –æ—Ç–∑—ã–≤—ã —á–∞—Å—Ç–æ, –Ω–æ –Ω–µ –≤—Å–µ–≥–¥–∞, –∏–º–µ—é—Ç ID —Å –±–æ–ª—å—à–µ–π —ç–Ω—Ç—Ä–æ–ø–∏–µ–π UUID, —á—Ç–æ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ —ç–≤—Ä–∏—Å—Ç–∏–∫—É, –æ–¥–Ω–∞–∫–æ –ø–æ—Ä—è–¥–æ–∫ ¬´ID ‚âà –ø–æ –¥–∞—Ç–µ¬ª –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω.paste.txt‚Äã
–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–≤–æ–¥
API Ozon –Ω–µ —Å–æ—Ä—Ç–∏—Ä—É–µ—Ç –æ—Ç–∑—ã–≤—ã –ø–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –º–æ–≥—É—Ç –±—ã—Ç—å —Å–º–µ—à–∞–Ω—ã.
–î–ª—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç–∑—ã–≤–æ–≤ –ª—É—á—à–µ:
—Å–æ—Ö—Ä–∞–Ω—è—Ç—å timestamp –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ—Ç–∑—ã–≤–∞;
—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ from_date / to_date –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—Ä–æ—Å–µ;
–∞ –∑–∞—Ç–µ–º —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ createdAt –Ω–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π —Å—Ç–æ—Ä–æ–Ω–µ.
–§–æ—Ä—É–º—ã Ozon for Dev –ø—Ä—è–º–æ –≥–æ–≤–æ—Ä—è—Ç: —ç—Ç–æ ¬´–∏–∑–≤–µ—Å—Ç–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ¬ª –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–µ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.ozon+2‚Äã
–ò—Ç–∞–∫, –æ—â—É—â–µ–Ω–∏–µ, —á—Ç–æ Ozon –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–∑—ã–≤—ã ¬´–Ω–µ –ø–æ –¥–∞—Ç–µ¬ª, –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç—Å—è: API –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ ‚Äî –æ—Ç–≤–µ—Ç —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –≤ –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–º –ø–æ—Ä—è–¥–∫–µ –∏ —Ç—Ä–µ–±—É–µ—Ç –ø–µ—Ä–µ—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞.
–ó–Ω–∞—á–∏—Ç. –Ω–∞–º –Ω–∞–¥–æ –ø–æ–ª–ª—é–±–æ–º—É –¥–µ–ª–∞—Ç—å –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ç–µ—Å—Ç—ã –∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ª–∏—Å—Ç—ã —Å –æ—Ç–∑—ã–≤–∞–º–∏! –Ω–æ –Ω–∞–º –Ω—É–∂–Ω–æ –∑–∞–ø–æ–º–∏–Ω–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å! –ò–ª–∏ —Å–Ω–∞—á–∞–ª–∞ –≤–Ω–æ—Å–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±–ª–∏—Ü—É, —á—Ç–æ–±—ã –ø–æ—Ç–æ–º –≤–µ—Å—Ç–∏ —Ä–∞–±–æ—Ç—É. –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∫–∞–∫-—Ç–æ –≤—Å—ë. –∏–ª–∏ –∫–∞–∫ –ª—É—á—à–µ —Å–¥–µ–ª–∞—Ç—å?
–ø–∏—à–∏ –ø–æ —Ä—É—Å—Å–∫–∏.
–û—Ç–ª–∏—á–Ω–æ–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ! –≠—Ç–æ –æ–±—ä—è—Å–Ω—è–µ—Ç –≤—Å–µ –ø—Ä–æ–±–ª–µ–º—ã —Å Ozon API. –ï—Å–ª–∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–∞, —Ç–æ –Ω—É–∂–Ω–æ –∫–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç–∑—ã–≤–æ–≤ Ozon.
Todo List
–î–∞–≤–∞–π—Ç–µ —Ä–∞–∑–±–µ—Ä–µ–º —ç—Ç—É –ø—Ä–æ–±–ª–µ–º—É —Å–∏—Å—Ç–µ–º–Ω–æ. –£ –Ω–∞—Å –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —Ä–µ—à–µ–Ω–∏—è:
–í–∞—Ä–∏–∞–Ω—Ç—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:



–î–≤—É—Ö—Ñ–∞–∑–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (—Ä–µ–∫–æ–º–µ–Ω–¥—É—é)
–§–∞–∑–∞ 1: –°–æ–±–∏—Ä–∞–µ–º –í–°–ï –æ—Ç–∑—ã–≤—ã –≤ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É/–º–∞—Å—Å–∏–≤
–§–∞–∑–∞ 2: –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º (–æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç—ã)
–ü–ª—é—Å—ã: –ü–æ–ª–Ω–∞—è –≥–∞—Ä–∞–Ω—Ç–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Å–µ—Ö –æ—Ç–∑—ã–≤–æ–≤, –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ú–∏–Ω—É—Å—ã: –ë–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –ø–µ—Ä–≤—É—é —Ñ–∞–∑—É

–ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
–î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–∑—ã–≤—ã –≤ —Ç–∞–±–ª–∏—Ü—É –ø–æ –º–µ—Ä–µ –ø–æ–ª—É—á–µ–Ω–∏—è
–ü—Ä–æ–≤–µ—Ä—è–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º
–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Å–æ—Ä—Ç–∏—Ä–æ–≤—ã–≤–∞–µ–º —Ç–∞–±–ª–∏—Ü—É
–ü–ª—é—Å—ã: –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤–∏–¥–Ω—ã, —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ —Ç–∞–π–º–∞—É—Ç–∞–º –ú–∏–Ω—É—Å—ã: –°–ª–æ–∂–Ω–µ–µ –ª–æ–≥–∏–∫–∞, –±–æ–ª—å—à–µ –æ–ø–µ—Ä–∞—Ü–∏–π —Å —Ç–∞–±–ª–∏—Ü–µ–π

–ì–∏–±—Ä–∏–¥–Ω—ã–π (–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π?)
–°–æ–±–∏—Ä–∞–µ–º –æ—Ç–∑—ã–≤—ã –ø–æ—Ä—Ü–∏—è–º–∏ (–ø–æ 20-50 —Å—Ç—Ä–∞–Ω–∏—Ü)
–ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –ø–æ—Ä—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ —Ç–∞–±–ª–∏—Ü—É
–ü–æ–º–µ—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –æ—Ç–∑—ã–≤—ã —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–º —Å—Ç–∞—Ç—É—Å–æ–º
–î–∞, –ø—Ä–∏ –¥–µ—Å—è—Ç–∫–∞—Ö —Ç—ã—Å—è—á –æ—Ç–∑—ã–≤–æ–≤ –ø–µ—Ä–µ—Å–∫–∞–Ω –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ–ø—Ä–∏–µ–º–ª–µ–º—ã–º ‚Äî –∏ –º–Ω–æ–≥–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ç–æ—Ä—ã Ozon —Å—Ç–∞–ª–∫–∏–≤–∞—é—Ç—Å—è —Å —ç—Ç–æ–π –ø—Ä–æ–±–ª–µ–º–æ–π. –ö–ª—é—á–µ–≤–∞—è —Ç—Ä—É–¥–Ω–æ—Å—Ç—å –≤ —Ç–æ–º, —á—Ç–æ API Ozon –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –≤—ã–¥–∞—á–∏ –æ—Ç–∑—ã–≤–æ–≤ –∏ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç ¬´–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ¬ª –≤—ã–≥—Ä—É–∑–∫–∏ –Ω–∞–ø—Ä—è–º—É—é. –û–¥–Ω–∞–∫–æ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ –∏ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ç–æ—Ä—ã –≤—ã—Ä–∞–±–æ—Ç–∞–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–∞–∫—Ç–∏—á–Ω—ã—Ö –æ–±—Ö–æ–¥–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π.ozon+2‚Äã
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ from_date
–ú–µ—Ç–æ–¥ /v1/review/list –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–¥–∞–≤–∞—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω –ø–æ –¥–∞—Ç–µ (date_created_from –∏ date_created_to). –ù–æ–≤—ã–µ –æ—Ç–∑—ã–≤—ã —á–∞—â–µ –≤—Å–µ–≥–æ –ø–æ–ø–∞–¥–∞—é—Ç –≤ —Å–≤–µ–∂–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –¥–∞–∂–µ –ø—Ä–∏ –ø–µ—Ä–µ–º–µ—à–∞–Ω–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ, –ø–æ—ç—Ç–æ–º—É:
—Ö—Ä–∞–Ω–∏—Ç—Å—è –º–µ—Ç–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ (max_created_at);
–ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—Ä–æ—Å–µ API –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Å –Ω–µ–±–æ–ª—å—à–∏–º –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ–º, –Ω–∞–ø—Ä–∏–º–µ—Ä from_date = last_date - 24h. –≠—Ç–æ —Å–Ω–∏–∂–∞–µ—Ç –ø—Ä–æ–ø—É—Å–∫ –≤–µ—Ä–æ—è—Ç–Ω—ã—Ö ¬´–ø–æ–∑–¥–Ω–∏—Ö¬ª –æ—Ç–∑—ã–≤–æ–≤, –∏ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –ø–æ–ª–Ω–æ–≥–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –ø—Ä–æ—Ö–æ–¥–∞ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü.paste.txt‚Äãozon‚Äã
–•—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ ID
–¢–∞–∫ –∫–∞–∫ Ozon –∏—Å–ø–æ–ª—å–∑—É–µ—Ç UUID –¥–ª—è –æ—Ç–∑—ã–≤–æ–≤, –∏–Ω—Ç–µ–≥—Ä–∞—Ç–æ—Ä—ã (–≤–∫–ª—é—á–∞—è MPStats –∏ Ozon Monitor) –ø—Ä–∏–º–µ–Ω—è—é—Ç –ª–æ–∫–∞–ª—å–Ω—É—é –±–∞–∑—É ID –≤—Å–µ—Ö —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –æ—Ç–∑—ã–≤–æ–≤. –†–∞–±–æ—á–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º:
–≤—ã–∫–∞—á–∏–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 3‚Äì5 —Ç—ã—Å—è—á –æ—Ç–∑—ã–≤–æ–≤ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –¥–Ω–µ–π;
–≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É —Ç–µ–∫—É—â–∏–º –∏ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–º –Ω–∞–±–æ—Ä–æ–º UUID;
–Ω–æ–≤—ã–µ ID –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è, —Å—Ç–∞—Ä—ã–µ –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è. –≠—Ç–æ —É—Å—Ç—Ä–∞–Ω—è–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –æ–±—Ö–æ–¥–∞ –∞—Ä—Ö–∏–≤–∞.ozon‚Äãpaste.txt‚Äã
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ—Ç–æ–∫–æ–≤ –≤—ã–±–æ—Ä–∫–∏
–ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–π –ø—Ä–µ–¥–ª–æ–∂–∏–ª–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ —Ä–∞–∑–±–∏–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ /v1/review/list –ø–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–º –æ–∫–Ω–∞–º, –Ω–∞–ø—Ä–∏–º–µ—Ä:
–æ—Ç–¥–µ–ª—å–Ω—ã–π worker –¥–ª—è –¥–∏–∞–ø–∞–∑–æ–Ω–∞ 3 —Å—É—Ç–æ–∫,
–¥—Ä—É–≥–æ–π ‚Äî –¥–ª—è –ø—Ä–æ—à–ª–æ–π –Ω–µ–¥–µ–ª–∏,
—Ç—Ä–µ—Ç–∏–π ‚Äî –¥–ª—è –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ —Å—Ç–∞—Ä—ã–º –æ—Ç–∑—ã–≤–∞–º (—Ä–µ–¥–∫–∏–µ, –Ω–æ –≤–æ–∑–º–æ–∂–Ω—ã–µ) –æ—Å—Ç–∞—é—Ç—Å—è –ø–æ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –±–µ–∑ —Ç–æ—Ç–∞–ª—å–Ω–æ–≥–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –æ–±—Ö–æ–¥–∞ –≤—Å–µ–π –∏—Å—Ç–æ—Ä–∏–∏.ozon‚Äã
–í—ã–Ω–æ—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤ –æ—á–µ—Ä–µ–¥—å (incremental loader)
–ï—Å–ª–∏ –æ—Ç–∑—ã–≤–æ–≤ –¥–µ—Å—è—Ç–∫–∏ —Ç—ã—Å—è—á, —Ä–µ—à–µ–Ω–∏–µ ‚Äî —Å—Ç—Ä–æ–∏—Ç—å –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π –∑–∞–≥—Ä—É–∑—á–∏–∫:
–∫–∞–∂–¥—ã–π –∑–∞–ø—É—Å–∫ API —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—Å–µ –æ—Ç–∑—ã–≤—ã –≤ –ª–æ–∫–∞–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É (–Ω–∞–ø—Ä–∏–º–µ—Ä PostgreSQL);
–Ω–æ–≤—ã–µ –∏–ª–∏ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –ø–æ id –∏ modified_at;
–¥–∞–ª—å—à–µ –≤ –æ—á–µ—Ä–µ–¥—å (RabbitMQ / Redis Streams) –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–µ–ª—å—Ç–∞-–æ—Ç–∑—ã–≤—ã –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏. –¢–∞–∫ –¥–µ–ª–∞—é—Ç –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤—Ä–æ–¥–µ 1–°‚ÄëOzon –∏ MPStats.ozon+1‚Äã
–ü–æ—á–µ–º—É –Ω–æ–≤—ã–µ –æ—Ç–∑—ã–≤—ã –º–æ–≥—É—Ç ¬´–≤—Å–ø–ª—ã–≤–∞—Ç—å¬ª —Å—Ä–µ–¥–∏ —Å—Ç–∞—Ä—ã—Ö
–ò–∑-–∑–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –æ—Ç–∑—ã–≤–æ–≤ –≤ —Å–µ—Ä–≤–∏—Å–µ Ozon Data Feedback Service –Ω–æ–≤—ã–π –æ—Ç–∑—ã–≤ –º–æ–∂–µ—Ç –ø–æ–ø–∞—Å—Ç—å –≤ ¬´—Å—Ç–∞—Ä—É—é¬ª —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ ‚Äî –∏–º–µ–Ω–Ω–æ –∏–∑-–∑–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω–¥–µ–∫—Å–∞. –≠—Ç–æ –ø—Ä–∏–∑–Ω–∞–Ω–æ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ: API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ ¬´–≤ –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–º –ø–æ—Ä—è–¥–∫–µ –±–µ–∑ —Å—Ç–∞–±–∏–ª—å–Ω–æ–≥–æ –∫–ª—é—á–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏¬ª.ozon+1‚Äã
–û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π
–î–µ—Ä–∂–∞—Ç—å max_created_at –∏ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ (—Ä–∞–∑ –≤ 30‚Äì60 –º–∏–Ω—É—Ç) –æ–ø—Ä–∞—à–∏–≤–∞—Ç—å /v1/review/list —Å from_date=max_created_at‚àí1–¥–µ–Ω—å.
–°–æ—Ö—Ä–∞–Ω—è—Ç—å –≤—Å–µ review_id –≤ –ª–æ–∫–∞–ª—å–Ω—É—é –±–∞–∑—É –∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è.
–†–∞–∑ –≤ –Ω–µ–¥–µ–ª—é –¥–µ–ª–∞—Ç—å ¬´–≥–ª—É–±–æ–∫–∏–π¬ª –ø–µ—Ä–µ—Å–º–æ—Ç—Ä 3‚Äì5 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å—Ç—Ä–∞–Ω–∏—Ü ‚Äî –Ω–∞ —Å–ª—É—á–∞–π –ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π –∏–Ω–¥–µ–∫—Å–∞.
–¢–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –Ω–∏ –æ–¥–∏–Ω –Ω–æ–≤—ã–π –æ—Ç–∑—ã–≤ –Ω–µ –ø–æ—Ç–µ—Ä—è–µ—Ç—Å—è, –º–∏–Ω–∏–º–∏–∑–∏—Ä—É—è —á–∏—Å–ª–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–∞–∂–µ –ø—Ä–∏ —Å–æ—Ç–Ω—è—Ö —Ç—ã—Å—è—á –∑–∞–ø–∏—Å–µ–π, –∏ —É—Å—Ç—Ä–∞–Ω—è–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Å—å –∞—Ä—Ö–∏–≤ –∑–∞–Ω–æ–≤–æ.
–í–æ—Ç –µ—â—ë. —Å–æ—Å—Ç–∞–≤—å –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ! –∫–æ—Ç–æ—Ä–æ–µ –ø–æ–∑–≤–æ–ª–∏—Ç –Ω–µ –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å –æ—Ç–∑—ã–≤—ã! –Ω–æ –ø—Ä–∏ —ç—Ç–æ–º –∞–ø–ø —Å–∫—Ä–∏–ø—Ç —Ä–∞–±–æ—Ç–∞ –±—É–¥–µ—Ç —É–∫–∞–ª–¥—ã–≤–∞—Ç—å—Å—è –≤ 6 –º–∏–Ω—É—Ç –Ω–∞ 1 —Ç—Ä–∏–≥–≥–µ—Ä? –ò –º—É–ª—å—Ç–∏–º–∞–≥–∞–∑–∏–Ω–æ—Å—Ç—å! —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ 10-20 –º–∞–≥–∞–∑–∏–Ω–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –æ–±—Å–ª—É–∂–∏–≤–∞—Ç—å, –∏ WB & OZON
–ü–û—á–µ–º—É –Ω–∞ –∫–∞–∂–¥—ã–π –º–∞–≥–∞–∑–∏–Ω –∏–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å—Å–±–æ—Ä–∞ –º—ã –Ω–µ –º–æ–∂–µ–º —Å–¥–µ–ª–∞—Ç—å —Å–≤–æ–π —Ç—Ä–∏–≥–≥–µ—Ä? —Å–∫–æ–ª—å–∫–æ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤ –º–æ–∂–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å—Å—è? —ç—Ç–æ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç —Ä–µ—à–µ–Ω–∏–µ?
–°–µ–π—á–∞—Å –º—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–∞–≥–∞–∑–∏–Ω–∞ –∑–∞–¥–∞—ë–º —Å–≤–æ–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏. –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è —Ç—Ä–∏–≥–≥–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ –æ—Å–Ω–æ–≤–Ω–æ–π –ª–æ–≥–∏–∫–µ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ.
–ø–æ–º–∏–º–æ —ç—Ç–æ–≥–æ. –ú–æ–≥—É—Ç –±—ã—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–±–∏—Ä–∞—é—Ç –æ—Ç–∑—ã–≤—ã –≤ —Ç–∞–±–ª–∏—Ü—É –∏ –¥–æ–±–∞–≤–ª—è—é—Ç –æ—Ç–≤–µ—Ç—ã, —Å–∫—Ä–∏–ø—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç —Å—Ç–∞—Ç—É—Å –æ—Ç–ø—Ä–∞–≤–∫–∏ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç –Ω–µ–æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ. –Ω–∞–º –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ, –Ω—É–∂–µ–Ω —Ç—Ä–∏–≥–≥–µ—Ä, –∫–æ—Ç—Ä—ã–π –ø—Ä–æ—Ö–æ–¥–∏—Ç—Å—è –ø–æ –≤—Å–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º –∏ —Å–æ–±–∏—Ä–∞–µ—Ç –æ—Ç–∑—ã–≤—ã, –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤ –¥–µ–Ω—å, –Ω–∞–ø—Ä–∏–º–µ—Ä. –ø–æ —Ñ–∞–∫—Ç—É, —Ä–∞–±–æ—Ç–∞—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä –¥–æ–ª–∂–µ–Ω –Ω–µ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç. –∞ —Ä–∞–∑ –≤ 4-6 —á–∞—Å–æ–≤, –Ω–∞–ø—Ä–∏–º–µ—Ä. —Å–æ–±—Ä–∞–ª, –¥–æ–±–∞–≤–∏–ª –Ω–æ–≤—ã–µ. –°–ª–µ–¥—É—é—â–∏–π —É–∂–µ –æ—Ç–ø—Ä–∞–≤–∏–ª.
–ö–∞–∫ —Ç–µ–±–µ —Ç–∞–∫–æ–µ??
–Ω—É–∂–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ –ø–ª–∞–Ω —Å–æ—Å—Ç–∞–≤–∏—Ç—å."
"–ü–æ–Ω—è–ª! –í—ã –ø—Ä–∞–≤—ã - —Ç—Ä–∏–≥–≥–µ—Ä—ã –¥–æ–ª–∂–Ω—ã —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ –º–∞–≥–∞–∑–∏–Ω–∞, –∏ –Ω—É–∂–Ω–æ —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–∏—Ç—å—Å—è –Ω–∞ Ozon API. –î–∞–≤–∞–π—Ç–µ —Å–æ—Å—Ç–∞–≤–∏–º –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π.


[1 tool called]


–°–Ω–∞—á–∞–ª–∞ –¥–∞–≤–∞–π—Ç–µ –∏–∑—É—á–∏–º —Ç–µ–∫—É—â—É—é —Å–∏—Å—Ç–µ–º—É —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤:


[3 tools called]


–î–∞–≤–∞–π—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ñ–∞–π–ª–∞ code.gs:


[2 tools called]


–¢–µ–ø–µ—Ä—å –¥–∞–≤–∞–π—Ç–µ –Ω–∞–π–¥–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∞–≥–∞–∑–∏–Ω–∞–º–∏:


[2 tools called]


–î–∞–≤–∞–π—Ç–µ –ø–æ–∏—â–µ–º –≤ HTML —Ñ–∞–π–ª–µ:


[2 tools called]


–î–∞–≤–∞–π—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ HTML —Ñ–∞–π–ª –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–æ:


[1 tool called]


–¢–µ–ø–µ—Ä—å –¥–∞–≤–∞–π—Ç–µ –Ω–∞–π–¥–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ saveStore –∏ deleteStore:


[1 tool called]


–û—Ç–ª–∏—á–Ω–æ! –¢–µ–ø–µ—Ä—å —è –ø–æ–Ω–∏–º–∞—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É. –î–∞–≤–∞–π—Ç–µ –Ω–∞–π–¥–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ getStores, saveStore, deleteStore –≤ code.gs:


[2 tools called]


–û—Ç–ª–∏—á–Ω–æ! –¢–µ–ø–µ—Ä—å —è –ø–æ–Ω–∏–º–∞—é —Ç–µ–∫—É—â—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É. –î–∞–≤–∞–π—Ç–µ —Å–æ—Å—Ç–∞–≤–∏–º –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π:


üéØ –ü–û–î–†–û–ë–ù–´–ô –ü–õ–ê–ù –î–ï–ô–°–¢–í–ò–ô

üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:


‚úÖ –ï—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ getStores(), saveStore(), deleteStore()

‚úÖ –ï—Å—Ç—å –±–∞–∑–æ–≤—ã–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã (createTrigger5Min(), createTrigger30Min())

‚úÖ –ï—Å—Ç—å —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –¥–ª—è Ozon

‚ùå –ù–ï–¢ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤ –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ –º–∞–≥–∞–∑–∏–Ω–∞

‚ùå –ù–ï–¢ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–∞–≥–∞–∑–∏–Ω–∞


üöÄ –≠–¢–ê–ü 1: –°–æ–∑–¥–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤

[1 tool called]


1.1 –î–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–∏–≥–≥–µ—Ä–∞–º–∏ –≤ code.gs

// ============ INDIVIDUAL STORE TRIGGERS ============

/**
 * –°–æ–∑–¥–∞–µ—Ç –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç—Ä–∏–≥–≥–µ—Ä –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –º–∞–≥–∞–∑–∏–Ω–∞
 * @param {Object} store - –û–±—ä–µ–∫—Ç –º–∞–≥–∞–∑–∏–Ω–∞
 * @param {number} intervalMinutes - –ò–Ω—Ç–µ—Ä–≤–∞–ª –≤ –º–∏–Ω—É—Ç–∞—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 240 = 4 —á–∞—Å–∞)
 */
function ensureStoreTrigger(store, intervalMinutes = 240) {
  if (!store || !store.id) {
    log(`[Trigger] ‚ùå –ù–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –º–∞–≥–∞–∑–∏–Ω–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç—Ä–∏–≥–≥–µ—Ä–∞`);
    return false;
  }
  
  const triggerName = `processStore_${store.id}`;
  const functionName = `processStore_${store.id}`;
  
  try {
    // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π —Ç—Ä–∏–≥–≥–µ—Ä –µ—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
    deleteStoreTrigger(store.id);
    
    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —Ç—Ä–∏–≥–≥–µ—Ä
    const trigger = ScriptApp.newTrigger(functionName)
      .timeBased()
      .everyMinutes(intervalMinutes)
      .create();
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
    saveTriggerConfig(store.id, {
      triggerId: trigger.getUniqueId(),
      intervalMinutes: intervalMinutes,
      createdAt: new Date().toISOString(),
      storeName: store.name,
      marketplace: store.marketplace
    });
    
    log(`[Trigger] ‚úÖ –¢—Ä–∏–≥–≥–µ—Ä –¥–ª—è ""${store.name}"" —Å–æ–∑–¥–∞–Ω: –∫–∞–∂–¥—ã–µ ${intervalMinutes} –º–∏–Ω—É—Ç`);
    return true;
    
  } catch (error) {
    log(`[Trigger] ‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç—Ä–∏–≥–≥–µ—Ä–∞ –¥–ª—è ""${store.name}"": ${error.message}`);
    return false;
  }
}

/**
 * –£–¥–∞–ª—è–µ—Ç —Ç—Ä–∏–≥–≥–µ—Ä –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –º–∞–≥–∞–∑–∏–Ω–∞
 * @param {string} storeId - ID –º–∞–≥–∞–∑–∏–Ω–∞
 */
function deleteStoreTrigger(storeId) {
  try {
    const triggers = ScriptApp.getProjectTriggers();
    const functionName = `processStore_${storeId}`;
    let deletedCount = 0;
    
    triggers.forEach(trigger => {
      if (trigger.getHandlerFunction() === functionName) {
        ScriptApp.deleteTrigger(trigger);
        deletedCount++;
      }
    });
    
    // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
    clearTriggerConfig(storeId);
    
    if (deletedCount > 0) {
      log(`[Trigger] üóëÔ∏è –£–¥–∞–ª–µ–Ω —Ç—Ä–∏–≥–≥–µ—Ä –¥–ª—è –º–∞–≥–∞–∑–∏–Ω–∞ ID: ${storeId}`);
    }
    
    return deletedCount > 0;
    
  } catch (error) {
    log(`[Trigger] ‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç—Ä–∏–≥–≥–µ—Ä–∞ –¥–ª—è –º–∞–≥–∞–∑–∏–Ω–∞ ${storeId}: ${error.message}`);
    return false;
  }
}

/**
 * –°–æ–∑–¥–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –º–∞–≥–∞–∑–∏–Ω–∞
 * @param {string} storeId - ID –º–∞–≥–∞–∑–∏–Ω–∞
 */
function createStoreProcessingFunction(storeId) {
  // –í Google Apps Script –Ω–µ–ª—å–∑—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏
  // –ü–æ—ç—Ç–æ–º—É –∏—Å–ø–æ–ª—å–∑—É–µ–º —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é-—Ä–æ—É—Ç–µ—Ä
  log(`[Trigger] üîß –°–æ–∑–¥–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –¥–ª—è –º–∞–≥–∞–∑–∏–Ω–∞ ${storeId}`);
}

/**
 * –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è-—Ä–æ—É—Ç–µ—Ä –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –º–∞–≥–∞–∑–∏–Ω–æ–≤
 * –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–º–∏ —Ç—Ä–∏–≥–≥–µ—Ä–∞–º–∏
 */
function processStoreRouter() {
  // –ü–æ–ª—É—á–∞–µ–º ID –º–∞–≥–∞–∑–∏–Ω–∞ –∏–∑ –∏–º–µ–Ω–∏ —Ñ—É–Ω–∫—Ü–∏–∏-—Ç—Ä–∏–≥–≥–µ—Ä–∞
  const functionName = arguments.callee.name;
  const storeId = functionName.replace('processStore_', '');
  
  if (!storeId || storeId === 'Router') {
    log(`[Trigger Router] ‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å ID –º–∞–≥–∞–∑–∏–Ω–∞ –∏–∑ –∏–º–µ–Ω–∏ —Ñ—É–Ω–∫—Ü–∏–∏: ${functionName}`);
    return;
  }
  
  log(`[Trigger Router] üöÄ –ó–∞–ø—É—Å–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –º–∞–≥–∞–∑–∏–Ω–∞ ID: ${storeId}`);
  
  try {
    const store = getStores().find(s => s.id === storeId);
    if (!store) {
      log(`[Trigger Router] ‚ùå –ú–∞–≥–∞–∑–∏–Ω —Å ID ${storeId} –Ω–µ –Ω–∞–π–¥–µ–Ω`);
      return;
    }
    
    if (!store.isActive) {
      log(`[Trigger Router] ‚è∏Ô∏è –ú–∞–≥–∞–∑–∏–Ω ""${store.name}"" –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º`);
      return;
    }
    
    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –º–∞–≥–∞–∑–∏–Ω
    processSingleStore(store, false); // false = –Ω–µ DEV —Ä–µ–∂–∏–º
    
  } catch (error) {
    log(`[Trigger Router] ‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –º–∞–≥–∞–∑–∏–Ω–∞ ${storeId}: ${error.message}`);
  }
}

1.2 –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é saveStore()

function saveStore(store) {
  log(`–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞: ${store.name}${store.settings && store.settings.startDate ? ' (–¥–∞—Ç–∞ –Ω–∞—á–∞–ª–∞: ' + store.settings.startDate + ')' : ''}`);
  const stores = getStores();
  const storeIndex = stores.findIndex(s => s.id === store.id);
  
  if (typeof store.isActive === 'undefined') store.isActive = true;
  if (!store.settings) store.settings = {};
  
  // üöÄ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
  let shouldResetProgress = false;
  if (storeIndex >= 0) {
    const oldStore = stores[storeIndex];
    const oldStartDate = oldStore.settings?.startDate;
    const newStartDate = store.settings?.startDate;
    const oldIncludeAnswered = oldStore.settings?.includeAnswered;
    const newIncludeAnswered = store.settings?.includeAnswered;
    const oldSortOldestFirst = oldStore.settings?.sortOldestFirst;
    const newSortOldestFirst = store.settings?.sortOldestFirst;
    
    if (oldStartDate !== newStartDate || 
        oldIncludeAnswered !== newIncludeAnswered || 
        oldSortOldestFirst !== newSortOldestFirst) {
      shouldResetProgress = true;
    }
  }
  
  if (storeIndex >= 0) {
    stores[storeIndex] = store;
  } else {
    store.id = Date.now().toString();
    stores.push(store);
  }
  
  if (shouldResetProgress) {
    resetStoreProgress(store.id);
    log(`[${store.name}] üîÑ –°–ë–†–û–®–ï–ù –ø—Ä–æ–≥—Ä–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑-–∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫`);
  }
  
  PropertiesService.getUserProperties().setProperty(CONFIG.PROPERTIES_KEY, JSON.stringify(stores));
  createOrGetSheet(`–û—Ç–∑—ã–≤—ã (${store.name})`, CONFIG.HEADERS);
  
  // üéØ –ù–û–í–û–ï: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä–æ–º
  if (store.isActive) {
    const intervalMinutes = getStoreTriggerInterval(store.id) || 240; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 4 —á–∞—Å–∞
    ensureStoreTrigger(store, intervalMinutes);
  } else {
    deleteStoreTrigger(store.id);
  }
  
  return getStores();
}

1.3 –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é deleteStore()

function deleteStore(storeId) {
  log(`–£–¥–∞–ª–µ–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞ —Å ID: ${storeId}`);
  
  // üéØ –ù–û–í–û–ï: –£–¥–∞–ª—è–µ–º —Ç—Ä–∏–≥–≥–µ—Ä –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º –º–∞–≥–∞–∑–∏–Ω–∞
  deleteStoreTrigger(storeId);
  
  let stores = getStores();
  stores = stores.filter(s => s.id !== storeId);
  PropertiesService.getUserProperties().setProperty(CONFIG.PROPERTIES_KEY, JSON.stringify(stores));
  return getStores();
}

üöÄ –≠–¢–ê–ü 2: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Ozon API (—Ñ–æ–∫—É—Å –Ω–∞ –ø—Ä–æ–±–ª–µ–º–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏)

[1 tool called]


2.1 –£–ª—É—á—à–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –¥–ª—è Ozon

// ============ OZON PROGRESS MANAGEMENT ============

/**
 * –ü–æ–ª—É—á–∞–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–ª—è Ozon –º–∞–≥–∞–∑–∏–Ω–∞
 * @param {string} storeId - ID –º–∞–≥–∞–∑–∏–Ω–∞
 * @returns {Object} –ü—Ä–æ–≥—Ä–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏
 */
function getOzonStoreProgress(storeId) {
  const progressKey = `ozon_progress_${storeId}`;
  const progressJson = PropertiesService.getScriptProperties().getProperty(progressKey);
  
  if (!progressJson) {
    return {
      lastCollectionTime: null,
      lastProcessedId: null,
      maxCreatedAt: null,
      collectionStrategy: 'incremental',
      processedCount: 0,
      totalPages: 0
    };
  }
  
  return JSON.parse(progressJson);
}

/**
 * –û–±–Ω–æ–≤–ª—è–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–ª—è Ozon –º–∞–≥–∞–∑–∏–Ω–∞
 * @param {string} storeId - ID –º–∞–≥–∞–∑–∏–Ω–∞
 * @param {Object} progressData - –î–∞–Ω–Ω—ã–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
 */
function updateOzonStoreProgress(storeId, progressData) {
  const progressKey = `ozon_progress_${storeId}`;
  const currentProgress = getOzonStoreProgress(storeId);
  
  const updatedProgress = {
    ...currentProgress,
    ...progressData,
    lastUpdated: new Date().toISOString()
  };
  
  PropertiesService.getScriptProperties().setProperty(progressKey, JSON.stringify(updatedProgress));
  log(`[Ozon Progress] üíæ –û–±–Ω–æ–≤–ª–µ–Ω –ø—Ä–æ–≥—Ä–µ—Å—Å –¥–ª—è –º–∞–≥–∞–∑–∏–Ω–∞ ${storeId}: ${JSON.stringify(progressData)}`);
}

/**
 * –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–±–æ—Ä –æ—Ç–∑—ã–≤–æ–≤ Ozon —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
 * @param {Object} store - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–∞–≥–∞–∑–∏–Ω–∞
 * @returns {Array} –ù–æ–≤—ã–µ –æ—Ç–∑—ã–≤—ã
 */
function collectOzonReviewsIncremental(store) {
  const progress = getOzonStoreProgress(store.id);
  const includeAnswered = store.settings?.includeAnswered || false;
  
  log(`[Ozon Incremental] üöÄ –ù–∞—á–∏–Ω–∞–µ–º –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–±–æ—Ä –¥–ª—è ""${store.name}""`);
  log(`[Ozon Incremental] üìä –¢–µ–∫—É—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å: –ø–æ—Å–ª–µ–¥–Ω—è—è –¥–∞—Ç–∞ ${progress.maxCreatedAt}, –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ ${progress.processedCount}`);
  
  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω –¥–∞—Ç –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞
  let fromDate = null;
  if (progress.maxCreatedAt) {
    fromDate = new Date(progress.maxCreatedAt);
    // –ü–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ 24 —á–∞—Å–∞ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
    fromDate.setHours(fromDate.getHours() - 24);
  } else if (store.settings?.startDate) {
    fromDate = new Date(store.settings.startDate);
  }
  
  const toDate = new Date();
  
  log(`[Ozon Incremental] üìÖ –î–∏–∞–ø–∞–∑–æ–Ω –∑–∞–ø—Ä–æ—Å–∞: ${fromDate ? fromDate.toISOString() : '–Ω–∞—á–∞–ª–æ'} - ${toDate.toISOString()}`);
  
  // –°–æ–±–∏—Ä–∞–µ–º –æ—Ç–∑—ã–≤—ã –∑–∞ –ø–µ—Ä–∏–æ–¥
  const newReviews = getOzonReviewsByDateRange(store, fromDate, toDate, includeAnswered);
  
  // –§–∏–ª—å—Ç—Ä—É–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã
  const uniqueReviews = filterDuplicateOzonReviews(newReviews, store.id);
  
  // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
  if (uniqueReviews.length > 0) {
    const maxCreatedAt = Math.max(...uniqueReviews.map(r => new Date(r.createdDate).getTime()));
    updateOzonStoreProgress(store.id, {
      lastCollectionTime: new Date().toISOString(),
      maxCreatedAt: new Date(maxCreatedAt).toISOString(),
      processedCount: progress.processedCount + uniqueReviews.length,
      lastProcessedId: uniqueReviews[uniqueReviews.length - 1].id
    });
  }
  
  log(`[Ozon Incremental] ‚úÖ –°–æ–±—Ä–∞–Ω–æ ${uniqueReviews.length} –Ω–æ–≤—ã—Ö —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –æ—Ç–∑—ã–≤–æ–≤`);
  return uniqueReviews;
}

/**
 * –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –¥–ª—è Ozon –æ—Ç–∑—ã–≤–æ–≤
 * @param {Array} reviews - –ú–∞—Å—Å–∏–≤ –æ—Ç–∑—ã–≤–æ–≤
 * @param {string} storeId - ID –º–∞–≥–∞–∑–∏–Ω–∞
 * @returns {Array} –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –æ—Ç–∑—ã–≤—ã
 */
function filterDuplicateOzonReviews(reviews, storeId) {
  const existingIds = getExistingOzonReviewIds(storeId);
  const uniqueReviews = [];
  
  reviews.forEach(review => {
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ ID
    if (existingIds.has(review.id)) {
      return; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –¥—É–±–ª–∏–∫–∞—Ç
    }
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ —Å–∏–≥–Ω–∞—Ç—É—Ä–µ (—Ç–æ–≤–∞—Ä + –¥–∞—Ç–∞ + —Ä–µ–π—Ç–∏–Ω–≥ + –ø–µ—Ä–≤—ã–µ 50 —Å–∏–º–≤–æ–ª–æ–≤)
    const signature = createOzonReviewSignature(review);
    if (isDuplicateOzonSignature(signature, storeId)) {
      return; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –¥—É–±–ª–∏–∫–∞—Ç
    }
    
    uniqueReviews.push(review);
  });
  
  log(`[Ozon Duplicates] üîç –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è: ${reviews.length} ‚Üí ${uniqueReviews.length} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –æ—Ç–∑—ã–≤–æ–≤`);
  return uniqueReviews;
}

üöÄ –≠–¢–ê–ü 3: –°–æ–∑–¥–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–∞–≥–∞–∑–∏–Ω–∞

3.1 –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–π-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

// ============ STORE PROCESSING FUNCTIONS ============

/**
 * –°–æ–∑–¥–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –º–∞–≥–∞–∑–∏–Ω–∞
 * –ü–æ—Å–∫–æ–ª—å–∫—É Google Apps Script –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π,
 * –∏—Å–ø–æ–ª—å–∑—É–µ–º —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—É—é —Å–∏—Å—Ç–µ–º—É —Å —Ä–æ—É—Ç–∏–Ω–≥–æ–º
 */

// –§—É–Ω–∫—Ü–∏–∏-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –º–∞–≥–∞–∑–∏–Ω–æ–≤ (—Å–æ–∑–¥–∞—é—Ç—Å—è –≤—Ä—É—á–Ω—É—é –¥–ª—è –∫–∞–∂–¥–æ–≥–æ ID)
// –ü—Ä–∏–º–µ—Ä –¥–ª—è –º–∞–≥–∞–∑–∏–Ω–∞ —Å ID ""1234567890"":
function processStore_1234567890() {
  processStoreById(""1234567890"");
}

function processStore_1234567891() {
  processStoreById(""1234567891"");
}

// ... –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ –¥–ª—è –≤—Å–µ—Ö –º–∞–≥–∞–∑–∏–Ω–æ–≤

/**
 * –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –º–∞–≥–∞–∑–∏–Ω–∞ –ø–æ ID
 * @param {string} storeId - ID –º–∞–≥–∞–∑–∏–Ω–∞
 */
function processStoreById(storeId) {
  const startTime = Date.now();
  log(`[Store ${storeId}] üöÄ –ù–∞—á–∏–Ω–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É –º–∞–≥–∞–∑–∏–Ω–∞`);
  
  try {
    const store = getStores().find(s => s.id === storeId);
    if (!store) {
      log(`[Store ${storeId}] ‚ùå –ú–∞–≥–∞–∑–∏–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω`);
      return;
    }
    
    if (!store.isActive) {
      log(`[Store ${storeId}] ‚è∏Ô∏è –ú–∞–≥–∞–∑–∏–Ω ""${store.name}"" –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω`);
      return;
    }
    
    log(`[Store ${storeId}] üìä –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º ""${store.name}"" [${store.marketplace}]`);
    
    // –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è Ozon
    if (store.marketplace === 'Ozon') {
      processOzonStoreIncremental(store);
    } else {
      // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è WB
      processSingleStore(store, false);
    }
    
    const duration = Math.round((Date.now() - startTime) / 1000);
    log(`[Store ${storeId}] ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ –∑–∞ ${duration} —Å–µ–∫—É–Ω–¥`);
    
  } catch (error) {
    log(`[Store ${storeId}] ‚ùå –û—à–∏–±–∫–∞: ${error.message}`);
  }
}

/**
 * –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ Ozon –º–∞–≥–∞–∑–∏–Ω–∞ —Å –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–º —Å–±–æ—Ä–æ–º
 * @param {Object} store - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–∞–≥–∞–∑–∏–Ω–∞
 */
function processOzonStoreIncremental(store) {
  log(`[Ozon ${store.id}] üéØ –ó–∞–ø—É—Å–∫ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏`);
  
  // 1. –°–æ–±–∏—Ä–∞–µ–º –Ω–æ–≤—ã–µ –æ—Ç–∑—ã–≤—ã
  const newReviews = collectOzonReviewsIncremental(store);
  
  if (newReviews.length === 0) {
    log(`[Ozon ${store.id}] ‚ÑπÔ∏è –ù–æ–≤—ã—Ö –æ—Ç–∑—ã–≤–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ`);
    return;
  }
  
  // 2. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ—Ç–∑—ã–≤—ã (–ø–æ–¥–±–∏—Ä–∞–µ–º –æ—Ç–≤–µ—Ç—ã –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º)
  processAndSendOzonAnswers(newReviews, store);
  
  // 3. –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ª–∏—Å—Ç –º–∞–≥–∞–∑–∏–Ω–∞
  saveOzonReviewsToSheet(newReviews, store);
  
  log(`[Ozon ${store.id}] ‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ ${newReviews.length} –Ω–æ–≤—ã—Ö –æ—Ç–∑—ã–≤–æ–≤`);
}

üöÄ –≠–¢–ê–ü 4: –°–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤

4.1 –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤

// ============ TRIGGER CONFIGURATION ============

/**
 * –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Ç—Ä–∏–≥–≥–µ—Ä–∞
 * @param {string} storeId - ID –º–∞–≥–∞–∑–∏–Ω–∞
 * @param {Object} config - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ç—Ä–∏–≥–≥–µ—Ä–∞
 */
function saveTriggerConfig(storeId, config) {
  const configKey = `trigger_config_${storeId}`;
  PropertiesService.getScriptProperties().setProperty(configKey, JSON.stringify(config));
}

/**
 * –ü–æ–ª—É—á–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Ç—Ä–∏–≥–≥–µ—Ä–∞
 * @param {string} storeId - ID –º–∞–≥–∞–∑–∏–Ω–∞
 * @returns {Object} –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ç—Ä–∏–≥–≥–µ—Ä–∞
 */
function getTriggerConfig(storeId) {
  const configKey = `trigger_config_${storeId}`;
  const configJson = PropertiesService.getScriptProperties().getProperty(configKey);
  return configJson ? JSON.parse(configJson) : null;
}

/**
 * –û—á–∏—â–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Ç—Ä–∏–≥–≥–µ—Ä–∞
 * @param {string} storeId - ID –º–∞–≥–∞–∑–∏–Ω–∞
 */
function clearTriggerConfig(storeId) {
  const configKey = `trigger_config_${storeId}`;
  PropertiesService.getScriptProperties().deleteProperty(configKey);
}

/**
 * –ü–æ–ª—É—á–∞–µ—Ç –∏–Ω—Ç–µ—Ä–≤–∞–ª —Ç—Ä–∏–≥–≥–µ—Ä–∞ –¥–ª—è –º–∞–≥–∞–∑–∏–Ω–∞
 * @param {string} storeId - ID –º–∞–≥–∞–∑–∏–Ω–∞
 * @returns {number} –ò–Ω—Ç–µ—Ä–≤–∞–ª –≤ –º–∏–Ω—É—Ç–∞—Ö
 */
function getStoreTriggerInterval(storeId) {
  const config = getTriggerConfig(storeId);
  return config ? config.intervalMinutes : 240; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 4 —á–∞—Å–∞
}

/**
 * –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∏–Ω—Ç–µ—Ä–≤–∞–ª —Ç—Ä–∏–≥–≥–µ—Ä–∞ –¥–ª—è –º–∞–≥–∞–∑–∏–Ω–∞
 * @param {string} storeId - ID –º–∞–≥–∞–∑–∏–Ω–∞
 * @param {number} intervalMinutes - –ò–Ω—Ç–µ—Ä–≤–∞–ª –≤ –º–∏–Ω—É—Ç–∞—Ö
 */
function setStoreTriggerInterval(storeId, intervalMinutes) {
  const store = getStores().find(s => s.id === storeId);
  if (!store) {
    log(`[Trigger Config] ‚ùå –ú–∞–≥–∞–∑–∏–Ω —Å ID ${storeId} –Ω–µ –Ω–∞–π–¥–µ–Ω`);
    return false;
  }
  
  // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
  const config = getTriggerConfig(storeId) || {};
  config.intervalMinutes = intervalMinutes;
  saveTriggerConfig(storeId, config);
  
  // –ü–µ—Ä–µ—Å–æ–∑–¥–∞–µ–º —Ç—Ä–∏–≥–≥–µ—Ä —Å –Ω–æ–≤—ã–º –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º
  if (store.isActive) {
    ensureStoreTrigger(store, intervalMinutes);
  }
  
  log(`[Trigger Config] ‚úÖ –ò–Ω—Ç–µ—Ä–≤–∞–ª –¥–ª—è ""${store.name}"" —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: ${intervalMinutes} –º–∏–Ω—É—Ç`);
  return true;
}

üöÄ –≠–¢–ê–ü 5: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ

5.1 –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

/**
 * –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç —Ç—Ä–∏–≥–≥–µ—Ä—ã —Å–æ —Å–ø–∏—Å–∫–æ–º –∞–∫—Ç–∏–≤–Ω—ã—Ö –º–∞–≥–∞–∑–∏–Ω–æ–≤
 * –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ onOpen –∏ –∏–∑ –º–µ–Ω—é
 */
function syncAllStoreTriggers() {
  log(`[Trigger Sync] üîÑ –ù–∞—á–∏–Ω–∞–µ–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤`);
  
  const stores = getStores();
  const activeStores = stores.filter(store => store.isActive);
  const triggers = ScriptApp.getProjectTriggers();
  
  let createdCount = 0;
  let deletedCount = 0;
  let errorCount = 0;
  
  // –°–æ–∑–¥–∞–µ–º —Ç—Ä–∏–≥–≥–µ—Ä—ã –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –º–∞–≥–∞–∑–∏–Ω–æ–≤
  activeStores.forEach(store => {
    const functionName = `processStore_${store.id}`;
    const existingTrigger = triggers.find(t => t.getHandlerFunction() === functionName);
    
    if (!existingTrigger) {
      try {
        const intervalMinutes = getStoreTriggerInterval(store.id);
        if (ensureStoreTrigger(store, intervalMinutes)) {
          createdCount++;
        } else {
          errorCount++;
        }
      } catch (error) {
        log(`[Trigger Sync] ‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç—Ä–∏–≥–≥–µ—Ä–∞ –¥–ª—è ""${store.name}"": ${error.message}`);
        errorCount++;
      }
    }
  });
  
  // –£–¥–∞–ª—è–µ–º —Ç—Ä–∏–≥–≥–µ—Ä—ã –¥–ª—è –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö/—É–¥–∞–ª–µ–Ω–Ω—ã—Ö –º–∞–≥–∞–∑–∏–Ω–æ–≤
  triggers.forEach(trigger => {
    const functionName = trigger.getHandlerFunction();
    if (functionName.startsWith('processStore_')) {
      const storeId = functionName.replace('processStore_', '');
      const store = stores.find(s => s.id === storeId);
      
      if (!store || !store.isActive) {
        try {
          ScriptApp.deleteTrigger(trigger);
          deletedCount++;
          log(`[Trigger Sync] üóëÔ∏è –£–¥–∞–ª–µ–Ω —Ç—Ä–∏–≥–≥–µ—Ä –¥–ª—è –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –º–∞–≥–∞–∑–∏–Ω–∞: ${storeId}`);
        } catch (error) {
          log(`[Trigger Sync] ‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç—Ä–∏–≥–≥–µ—Ä–∞ ${storeId}: ${error.message}`);
          errorCount++;
        }
      }
    }
  });
  
  log(`[Trigger Sync] ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞: —Å–æ–∑–¥–∞–Ω–æ ${createdCount}, —É–¥–∞–ª–µ–Ω–æ ${deletedCount}, –æ—à–∏–±–æ–∫ ${errorCount}`);
  
  return {
    created: createdCount,
    deleted: deletedCount,
    errors: errorCount,
    totalActiveStores: activeStores.length
  };
}

üöÄ –≠–¢–ê–ü 6: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ onOpen()

function onOpen(e) {
  const ui = SpreadsheetApp.getUi();
  
  // –°–æ–∑–¥–∞–µ–º –º–µ–Ω—é
  const menu = ui.createMenu('ü§ñ –ê–≤—Ç–æ–æ—Ç–≤–µ—Ç—ã');
  
  // –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
  menu.addItem('üöÄ –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤—Å–µ –º–∞–≥–∞–∑–∏–Ω—ã', 'processAllStores');
  menu.addItem('üîÑ –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ WB', 'processWildberriesStores');
  menu.addItem('üü† –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ Ozon', 'processOzonStores');
  menu.addSeparator();
  
  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞–º–∏
  menu.addItem('üè™ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞–º–∏', 'showStoreManager');
  menu.addSeparator();
  
  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä–∞–º–∏
  const triggerSubMenu = ui.createMenu('üîÑ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–æ–º');
  triggerSubMenu.addItem('üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã', 'syncAllStoreTriggers');
  triggerSubMenu.addItem('üìä –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤', 'showTriggerStatus');
  triggerSubMenu.addSeparator();
  triggerSubMenu.addItem('‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤', 'showTriggerIntervalSettings');
  triggerSubMenu.addItem('üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –≤—Å–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã', 'deleteAllTriggers');
  menu.addSubMenu(triggerSubMenu);
  
  // –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
  menu.addSeparator();
  menu.addItem('üß™ –¢–µ—Å—Ç WB API', 'testWbApi');
  menu.addItem('üß™ –¢–µ—Å—Ç Ozon API', 'testOzonApi');
  menu.addSeparator();
  menu.addItem('üêû –õ–æ–≥ –æ—Ç–ª–∞–¥–∫–∏', 'showDebugLog');
  
  menu.addToUi();
  
  // üéØ –ù–û–í–û–ï: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
  try {
    const syncResult = syncAllStoreTriggers();
    log(`[onOpen] üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤: —Å–æ–∑–¥–∞–Ω–æ ${syncResult.created}, —É–¥–∞–ª–µ–Ω–æ ${syncResult.deleted}, –æ—à–∏–±–æ–∫ ${syncResult.errors}`);
  } catch (error) {
    log(`[onOpen] ‚ùå –û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤: ${error.message}`);
  }
}

[1 tool called]


üéØ –ü–õ–ê–ù –†–ï–ê–õ–ò–ó–ê–¶–ò–ò - –ü–û–®–ê–ì–û–í–û

üìã –ß–¢–û –î–ï–õ–ê–¢–¨ –ü–†–Ø–ú–û –°–ï–ô–ß–ê–°:

–®–ê–ì 1: –î–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–∏–≥–≥–µ—Ä–∞–º–∏ –≤ code.gs


–î–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ ensureStoreTrigger(), deleteStoreTrigger(), processStoreById()

–ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å saveStore() –∏ deleteStore()

–î–æ–±–∞–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤


–®–ê–ì 2: –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –º–∞–≥–∞–∑–∏–Ω–æ–≤


–°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ processStore_1234567890() –¥–ª—è –∫–∞–∂–¥–æ–≥–æ ID –º–∞–≥–∞–∑–∏–Ω–∞

–î–æ–±–∞–≤–∏—Ç—å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é processStoreById()


–®–ê–ì 3: –£–ª—É—á—à–∏—Ç—å Ozon API –æ–±—Ä–∞–±–æ—Ç–∫—É


–î–æ–±–∞–≤–∏—Ç—å –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–±–æ—Ä —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

–£–ª—É—á—à–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –¥–ª—è Ozon

–î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –¥—É–±–ª–∏–∫–∞—Ç–æ–≤


–®–ê–ì 4: –û–±–Ω–æ–≤–∏—Ç—å –º–µ–Ω—é –∏ onOpen()


–î–æ–±–∞–≤–∏—Ç—å –ø—É–Ω–∫—Ç—ã –º–µ–Ω—é –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–∏–≥–≥–µ—Ä–∞–º–∏

–î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏


–®–ê–ì 5: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ


–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤

–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É Ozon –º–∞–≥–∞–∑–∏–Ω–æ–≤

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å–∏—Å—Ç–µ–º—ã –¥—É–±–ª–∏–∫–∞—Ç–æ–≤


üöÄ –ì–û–¢–û–í–´ –ù–ê–ß–ò–ù–ê–¢–¨?

–ü—Ä–µ–¥–ª–∞–≥–∞—é –Ω–∞—á–∞—Ç—å —Å –®–ê–ì–ê 1 - –¥–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–∏–≥–≥–µ—Ä–∞–º–∏ –≤ code.gs.


–•–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã —è:



–°–æ–∑–¥–∞–ª –≥–æ—Ç–æ–≤—ã–π –∫–æ–¥ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ code.gs?

–ü–æ–∫–∞–∑–∞–ª –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –º–µ—Å—Ç–∞ –≥–¥–µ –Ω—É–∂–Ω–æ –≤—Å—Ç–∞–≤–∏—Ç—å –∫–æ–¥?

–ù–∞—á–∞–ª —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, ensureStoreTrigger())?


–ö–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç–µ?


[1 tool called]"


–ø–æ—á–∏—Ç–∞–π –µ—â—ë –ø–∞–ø–∫—É for_check.
–ü–æ—Å–º–æ—Ç—Ä–∏, –∫–∞–∫ —É –Ω–∞—Å, –∏ –∫–∞–∫–∏–µ –µ—Å—Ç—å –ø—Ä–µ–¥–æ–∂–µ–∏–Ω—è
–ø–æ–∫–∞ –ø—Ä–µ–¥–ª–æ–∂–∏ –ø–ª–∞–Ω. –º–µ–Ω—è —Å–∏–ª—å–Ω–µ–µ –≤—Å–µ–≥–æ –±–µ—Å–ø–æ–∫–æ–∏—Ç –∏–º–µ–Ω–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫—É—á–∏ —Å—Ç—Ä–∞–Ω–∏.
–î–∞–≤–∞–π—Ç–µ –∏–∑—É—á–∏–º –ø–∞–ø–∫—É for_check –∏ –ø–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è, –æ—Å–æ–±–µ–Ω–Ω–æ –∫–∞—Å–∞—é—â–∏–µ—Å—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å—Ç—Ä–∞–Ω–∏—Ü.


Listed 6 items in current directory and read 4 files
–¢–µ–ø–µ—Ä—å –¥–∞–≤–∞–π—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ —Ñ–∞–π–ª —Å API —Ñ–∏–∫—Å–∞–º–∏:


Read api_fixies_pr.md
–û—Ç–ª–∏—á–Ω–æ! –¢–µ–ø–µ—Ä—å —É –º–µ–Ω—è –µ—Å—Ç—å –ø–æ–ª–Ω–∞—è –∫–∞—Ä—Ç–∏–Ω–∞. –î–∞–≤–∞–π—Ç–µ —Å–æ—Å—Ç–∞–≤–∏–º –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –ø–ª–∞–Ω —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å—Ç—Ä–∞–Ω–∏—Ü Ozon API.


üéØ –ö–û–ú–ü–õ–ï–ö–°–ù–´–ô –ü–õ–ê–ù –†–ï–®–ï–ù–ò–Ø –ü–†–û–ë–õ–ï–ú–´ OZON API
üìä –ê–ù–ê–õ–ò–ó –ü–†–û–ë–õ–ï–ú–´
–ò–∑ –∏–∑—É—á–µ–Ω–∏—è –ø–∞–ø–∫–∏ for_check –∏ –≤–∞—à–µ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è —è –ø–æ–Ω–∏–º–∞—é:


–û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞: Ozon API –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É –ø–æ –¥–∞—Ç–µ - –æ—Ç–∑—ã–≤—ã –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ "—Å–ø—É—Ç–∞–Ω–Ω–æ–º" –ø–æ—Ä—è–¥–∫–µ
–ú–∞—Å—à—Ç–∞–±: –ü—Ä–∏ –¥–µ—Å—è—Ç–∫–∞—Ö —Ç—ã—Å—è—á –æ—Ç–∑—ã–≤–æ–≤ –ø–æ–ª–Ω—ã–π –ø–µ—Ä–µ—Å–∫–∞–Ω –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ–ø—Ä–∏–µ–º–ª–µ–º—ã–º
–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: –ï—Å—Ç—å —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞, –Ω–æ –æ–Ω–∞ –Ω–µ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –∏ –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
üöÄ –†–ï–®–ï–ù–ò–ï: –ì–ò–ë–†–ò–î–ù–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê
–ü—Ä–µ–¥–ª–∞–≥–∞—é 3-—É—Ä–æ–≤–Ω–µ–≤—É—é —Å–∏—Å—Ç–µ–º—É –æ–±—Ä–∞–±–æ—Ç–∫–∏ Ozon –æ—Ç–∑—ã–≤–æ–≤:


–£–†–û–í–ï–ù–¨ 1: –ò–ù–ö–†–ï–ú–ï–ù–¢–ê–õ–¨–ù–´–ô –°–ë–û–† (–∫–∞–∂–¥—ã–µ 4-6 —á–∞—Å–æ–≤)
–°–æ–±–∏—Ä–∞–µ–º —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ –æ—Ç–∑—ã–≤—ã –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24-48 —á–∞—Å–æ–≤
–ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ –¥–∞—Ç –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
–§–∏–ª—å—Ç—Ä—É–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã –ø–æ ID –∏ —Å–∏–≥–Ω–∞—Ç—É—Ä–µ
–£–†–û–í–ï–ù–¨ 2: –ì–õ–£–ë–û–ö–ê–Ø –ü–†–û–í–ï–†–ö–ê (—Ä–∞–∑ –≤ –¥–µ–Ω—å)
–ü–µ—Ä–µ—Å–º–∞—Ç—Ä–∏–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3-5 —Å—Ç—Ä–∞–Ω–∏—Ü
–ù–∞ —Å–ª—É—á–∞–π "–≤—Å–ø–ª—ã–≤–∞–Ω–∏—è" —Å—Ç–∞—Ä—ã—Ö –æ—Ç–∑—ã–≤–æ–≤ –≤ –Ω–æ–≤—ã—Ö –ø–æ–∑–∏—Ü–∏—è—Ö
–£–†–û–í–ï–ù–¨ 3: –ü–û–õ–ù–´–ô –°–ö–ê–ù (—Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é)
–ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ—Å–∫–∞–Ω –≤—Å–µ—Ö –æ—Ç–∑—ã–≤–æ–≤ –∑–∞ –ø–µ—Ä–∏–æ–¥
–î–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –ª—é–±—ã—Ö –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –æ—Ç–∑—ã–≤–æ–≤
üîß –î–ï–¢–ê–õ–¨–ù–´–ô –ü–õ–ê–ù –†–ï–ê–õ–ò–ó–ê–¶–ò–ò
–≠–¢–ê–ü 1: –°–æ–∑–¥–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤
// 1.1 –§—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–∏–≥–≥–µ—Ä–∞–º–∏
function ensureStoreTrigger(store, intervalMinutes = 240) {
// –°–æ–∑–¥–∞–µ—Ç —Ç—Ä–∏–≥–≥–µ—Ä –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –º–∞–≥–∞–∑–∏–Ω–∞
// –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 4 —á–∞—Å–∞ (240 –º–∏–Ω—É—Ç)
}


function deleteStoreTrigger(storeId) {
// –£–¥–∞–ª—è–µ—Ç —Ç—Ä–∏–≥–≥–µ—Ä –º–∞–≥–∞–∑–∏–Ω–∞
}


function syncAllStoreTriggers() {
// –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –≤—Å–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
}
–≠–¢–ê–ü 2: –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è Ozon
// 2.1 –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
function getOzonStoreProgress(storeId) {
// –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: lastCollectionTime, lastProcessedId, maxCreatedAt
}


function updateOzonStoreProgress(storeId, progressData) {
// –û–±–Ω–æ–≤–ª—è–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏
}


// 2.2 –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–±–æ—Ä —Å –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ–º –¥–∞—Ç
function collectOzonReviewsIncremental(store) {
// –°–æ–±–∏—Ä–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ –æ—Ç–∑—ã–≤—ã –∑–∞ –ø–µ—Ä–∏–æ–¥
// –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ 24-48 —á–∞—Å–æ–≤ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
// –§–∏–ª—å—Ç—Ä—É–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã –ø–æ ID –∏ —Å–∏–≥–Ω–∞—Ç—É—Ä–µ
}


// 2.3 –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
function filterDuplicateOzonReviews(reviews, storeId) {
// –ü—Ä–æ–≤–µ—Ä—è–µ—Ç ID –ø—Ä–æ—Ç–∏–≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –≤ –ª–∏—Å—Ç–µ
// –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–∏–≥–Ω–∞—Ç—É—Ä—É (—Ç–æ–≤–∞—Ä + –¥–∞—Ç–∞ + —Ä–µ–π—Ç–∏–Ω–≥ + —Ç–µ–∫—Å—Ç)
// –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –æ—Ç–∑—ã–≤—ã
}
–≠–¢–ê–ü 3: –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏
// 3.1 –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ Ozon –º–∞–≥–∞–∑–∏–Ω–∞
function processOzonStoreIncremental(store) {
const strategy = determineOzonCollectionStrategy(store);


switch(strategy) {
case 'incremental':
return collectOzonReviewsIncremental(store);
case 'deep_check':
return collectOzonReviewsDeepCheck(store);
case 'full_scan':
return collectOzonReviewsFullScan(store);
}
}


// 3.2 –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Å–±–æ—Ä–∞
function determineOzonCollectionStrategy(store) {
const progress = getOzonStoreProgress(store.id);
const now = new Date();
const lastCollection = progress.lastCollectionTime ? new Date(progress.lastCollectionTime) : null;


// –ï—Å–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Å–±–æ—Ä –±—ã–ª –±–æ–ª—å—à–µ 6 —á–∞—Å–æ–≤ –Ω–∞–∑–∞–¥ - –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π
if (!lastCollection || (now - lastCollection) > 6 * 60 * 60 * 1000) {
return 'incremental';
}


// –ï—Å–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π –≥–ª—É–±–æ–∫–∏–π —Å–∫–∞–Ω –±—ã–ª –±–æ–ª—å—à–µ 24 —á–∞—Å–æ–≤ –Ω–∞–∑–∞–¥ - –≥–ª—É–±–æ–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
if (!progress.lastDeepCheck || (now - new Date(progress.lastDeepCheck)) > 24 * 60 * 60 * 1000) {
return 'deep_check';
}


// –ï—Å–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π –ø–æ–ª–Ω—ã–π —Å–∫–∞–Ω –±—ã–ª –±–æ–ª—å—à–µ 7 –¥–Ω–µ–π –Ω–∞–∑–∞–¥ - –ø–æ–ª–Ω—ã–π —Å–∫–∞–Ω
if (!progress.lastFullScan || (now - new Date(progress.lastFullScan)) > 7 * 24 * 60 * 60 * 1000) {
return 'full_scan';
}


return 'incremental';
}
–≠–¢–ê–ü 4: –°–∏—Å—Ç–µ–º–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
// 4.1 –•—Ä–∞–Ω–µ–Ω–∏–µ ID –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –æ—Ç–∑—ã–≤–æ–≤
function getProcessedOzonReviewIds(storeId) {
// –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç Set —Å ID –≤—Å–µ—Ö –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –æ—Ç–∑—ã–≤–æ–≤
// –•—Ä–∞–Ω–∏—Ç—Å—è –≤ ScriptProperties –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
}


function addProcessedOzonReviewIds(storeId, reviewIds) {
// –î–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—ã–µ ID –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
// –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç —Ä–∞–∑–º–µ—Ä —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10000 ID)
}


// 4.2 –°–æ–∑–¥–∞–Ω–∏–µ —Å–∏–≥–Ω–∞—Ç—É—Ä –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
function createOzonReviewSignature(review) {
// –°–æ–∑–¥–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—É—é —Å–∏–≥–Ω–∞—Ç—É—Ä—É: —Ç–æ–≤–∞—Ä + –¥–∞—Ç–∞ + —Ä–µ–π—Ç–∏–Ω–≥ + –ø–µ—Ä–≤—ã–µ 50 —Å–∏–º–≤–æ–ª–æ–≤ —Ç–µ–∫—Å—Ç–∞
return ${review.product.id}_${review.createdDate}_${review.rating}_${review.text.substring(0, 50)};
}


function isDuplicateOzonSignature(signature, storeId) {
// –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–∏–≥–Ω–∞—Ç—É—Ä—É –ø—Ä–æ—Ç–∏–≤ –±–∞–∑—ã –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Å–∏–≥–Ω–∞—Ç—É—Ä
}
–≠–¢–ê–ü 5: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
// 5.1 –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –ª–∏–º–∏—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤
function getAdaptiveOzonLimits(store) {
const progress = getOzonStoreProgress(store.id);
const processedCount = progress.processedCount || 0;


// –î–ª—è –±–æ–ª—å—à–∏—Ö –º–∞–≥–∞–∑–∏–Ω–æ–≤ —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –ª–∏–º–∏—Ç —Å—Ç—Ä–∞–Ω–∏—Ü
if (processedCount > 10000) {
return { maxPages: 50, pageSize: 1000 };
} else if (processedCount > 5000) {
return { maxPages: 30, pageSize: 500 };
} else {
return { maxPages: 20, pageSize: 200 };
}
}


// 5.2 –°–∏—Å—Ç–µ–º–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤
function prioritizeOzonReviews(reviews) {
// –°–æ—Ä—Ç–∏—Ä—É–µ—Ç –æ—Ç–∑—ã–≤—ã –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É:
// 1. –ù–æ–≤—ã–µ –æ—Ç–∑—ã–≤—ã (–∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞)
// 2. –í—ã—Å–æ–∫–∏–π —Ä–µ–π—Ç–∏–Ω–≥ (4-5 –∑–≤–µ–∑–¥)
// 3. –î–ª–∏–Ω–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã (–±–æ–ª–µ–µ 100 —Å–∏–º–≤–æ–ª–æ–≤)
// 4. –û—Å—Ç–∞–ª—å–Ω—ã–µ
}
üìä –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –°–ò–°–¢–ï–ú–´
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    OZON –û–ë–†–ê–ë–û–¢–ö–ê                           ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  –¢–†–ò–ì–ì–ï–† (–∫–∞–∂–¥—ã–µ 4-6 —á–∞—Å–æ–≤)                                ‚îÇ
‚îÇ  ‚Üì                                                          ‚îÇ
‚îÇ  processOzonStoreIncremental(store)                        ‚îÇ
‚îÇ  ‚Üì                                                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ  –û–ü–†–ï–î–ï–õ–ï–ù–ò–ï –°–¢–†–ê–¢–ï–ì–ò–ò                                 ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚Üì incremental / deep_check / full_scan                ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ  ‚Üì                                                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ  –°–ë–û–† –û–¢–ó–´–í–û–í                                          ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚Üì —Å –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ–º –¥–∞—Ç + —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤           ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ  ‚Üì                                                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ  –û–ë–†–ê–ë–û–¢–ö–ê –ò –û–¢–ü–†–ê–í–ö–ê                                 ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚Üì –ø–æ–¥–±–æ—Ä –æ—Ç–≤–µ—Ç–æ–≤ + –æ—Ç–ø—Ä–∞–≤–∫–∞ + —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ª–∏—Å—Ç      ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ  ‚Üì                                                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ  –û–ë–ù–û–í–õ–ï–ù–ò–ï –ü–†–û–ì–†–ï–°–°–ê                                 ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚Üì lastCollectionTime, processedIds, signatures       ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
üéØ –ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê –†–ï–®–ï–ù–ò–Ø
–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: –ù–µ —Å–∫–∞–Ω–∏—Ä—É–µ–º –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∫–∞–∂–¥—ã–π —Ä–∞–∑
–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å: –ü–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ –¥–∞—Ç + —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å: –†–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –ª—é–±–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ—Ç–∑—ã–≤–æ–≤
–ì–∏–±–∫–æ—Å—Ç—å: –†–∞–∑–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏–π
–û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å: –°–∏—Å—Ç–µ–º–∞ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ —Å–±–æ–µ–≤
üìã –ü–õ–ê–ù –í–ù–ï–î–†–ï–ù–ò–Ø
–®–ê–ì 1: –°–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤ (1-2 —á–∞—Å–∞)
–î–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–∏–≥–≥–µ—Ä–∞–º–∏ –≤ code.gs
–ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å saveStore() –∏ deleteStore()
–®–ê–ì 2: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–±–æ—Ä (2-3 —á–∞—Å–∞)
–°–æ–∑–¥–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –¥–ª—è Ozon
–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
–î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ –¥–∞—Ç
–®–ê–ì 3: –î–æ–±–∞–≤–∏—Ç—å –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—É—é —Å–∏—Å—Ç–µ–º—É (1-2 —á–∞—Å–∞)
–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Å–±–æ—Ä–∞
–î–æ–±–∞–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤
–®–ê–ì 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (1-2 —á–∞—Å–∞)
–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
üöÄ –ì–û–¢–û–í–´ –ù–ê–ß–ò–ù–ê–¢–¨?
–ü—Ä–µ–¥–ª–∞–≥–∞—é –Ω–∞—á–∞—Ç—å —Å –®–ê–ì–ê 1 - —Å–æ–∑–¥–∞–Ω–∏—è –±–∞–∑–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤.


–•–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã —è:


–°–æ–∑–¥–∞–ª –≥–æ—Ç–æ–≤—ã–π –∫–æ–¥ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ code.gs?
–ü–æ–∫–∞–∑–∞–ª –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –º–µ—Å—Ç–∞ –≥–¥–µ –Ω—É–∂–Ω–æ –≤—Å—Ç–∞–≤–∏—Ç—å –∫–æ–¥?
–ù–∞—á–∞–ª —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, ensureStoreTrigger())?
–ö–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç–µ?


–£–†–û–í–ï–ù–¨ 1: –ò–ù–ö–†–ï–ú–ï–ù–¢–ê–õ–¨–ù–´–ô –°–ë–û–† (–∫–∞–∂–¥—ã–µ 4-6 —á–∞—Å–æ–≤)
–°–æ–±–∏—Ä–∞–µ–º —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ –æ—Ç–∑—ã–≤—ã –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24-48 —á–∞—Å–æ–≤
–ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ –¥–∞—Ç –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
–§–∏–ª—å—Ç—Ä—É–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã –ø–æ ID –∏ —Å–∏–≥–Ω–∞—Ç—É—Ä–µ


–¥–∞, –Ω–æ –º—ã —É–∂–µ –≤—ã—è—Å–Ω–∏–ª–∏, —á—Ç–æ —Ç—Ä–∏–≥–≥–µ—Ä—ã —Ç–∞–∫ —Ä–µ–¥–∫–æ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç!
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç Set —Å ID –≤—Å–µ—Ö –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –æ—Ç–∑—ã–≤–æ–≤ - –∞ —ç—Ç–æ –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∑–∏—Ç —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–ø–µ—Ä—Ç–∏—Å?? —Ç–∞–º –≤—Ä–æ–¥–µ 9–∫–±. –ú—ã —É–±—å—ë–º –µ–≥–æ, –Ω–µ??


—Ç–æ –µ—Å—Ç—å —Ç—ã –ø—Ä–µ–¥–ª–∞–≥–∞–µ—à—å –ø–æ 3 —É—Ä–æ–≤–Ω—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–∞–≥–∞–∑–∏–Ω–∞? —Ç–∞–∫?


–Ω—É–∂–Ω–æ –º–µ–Ω—è—Ç—å –∫–æ–¥ —Ç–æ–ª—å–∫–æ –≤ –æ–∑–æ–Ω_—Ñ—É–Ω–∫—à–Ω.–≥—Å!
–æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥ –Ω–µ —Ç—Ä–æ–≥–∞–π. –Ω–µ –∑–∞–±—É–¥—å –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç!


–£ –∫–∞–∂–¥–æ–≥–æ –º–∞–≥–∞–∑–∏–Ω–∞ —Å–≤–æ–π –ª–∏—Å—Ç —Å —Ä–µ–∑—É–ª—å—Ç–∞–º–∏! —É –Ω–∞—Å –∂–µ –±—É–¥–µ—Ç –Ω–∞–∫–æ–Ω–µ—Ü –ø—Ä–æ—Ü–µ—Å—Å –ø–æ—ç—Ç–∞–ø–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è? 1 –±–æ—Ç —Å–æ–±–∏—Ä–∞–µ—Ç –æ—Ç—ã–∑–≤—ã –∏ –≤–Ω–æ—Å–∏—Ç –≤ —Ç–∞–±–ª–∏—Ü—É, –¥—Ä—É–≥–æ–π –¥–æ–±–∞–≤–ª—è–µ—Ç –∫ –Ω–∏–º —Ä–∞–Ω–¥–æ–º–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏–∑ —Å–æ–æ—Ç–≤–µ—Ç—Å–≤—é—É—â–µ–≥–æ –ª–∏—Å—Ç–∞ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç. –∏ –º–µ–Ω—è–µ—Ç –≤ –ª–∏—Å—Ç–µ —Å—Ç–∞—Ç—É—Å –Ω–∞–ø—Ä–æ—Ç–∏–≤ –∫–∞–∂–¥–æ–≥–æ –æ—Ç–∑—ã–≤–∞!


–ß—Ç–æ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–π –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–∞–≥–∞–∑–∏–Ω–∞???
–í –æ–±—â–µ–º, –ø–æ–∫–∞ –Ω–µ —É–≤–∏–¥–µ–ª –ø–æ–ª–Ω–æ–π –∫–∞—Ä—Ç–∏–Ω—ã. –ß–¢–æ –¥—É–º–∞–µ—à—å?
–û—Ç–ª–∏—á–Ω–æ! –í—ã –ø—Ä–∞–≤—ã –ø–æ –≤—Å–µ–º –ø—É–Ω–∫—Ç–∞–º. –î–∞–≤–∞–π—Ç–µ –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–∏–º –ø–æ–¥—Ö–æ–¥ —Å —É—á–µ—Ç–æ–º –≤–∞—à–∏—Ö –∑–∞–º–µ—á–∞–Ω–∏–π:


üéØ –ü–ï–†–ï–°–ú–û–¢–†–ï–ù–ù–´–ô –ü–õ–ê–ù
‚ùå –ü–†–û–ë–õ–ï–ú–´ –ú–û–ï–ì–û –ü–†–ï–î–õ–û–ñ–ï–ù–ò–Ø:
–¢—Ä–∏–≥–≥–µ—Ä—ã –∫–∞–∂–¥—ã–µ 4-6 —á–∞—Å–æ–≤ - Google Apps Script –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç–∞–∫–∏–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã
ScriptProperties 9KB –ª–∏–º–∏—Ç - —Ö—Ä–∞–Ω–µ–Ω–∏–µ ID –æ—Ç–∑—ã–≤–æ–≤ —É–±—å–µ—Ç —Å–∏—Å—Ç–µ–º—É
3 —É—Ä–æ–≤–Ω—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–∞–≥–∞–∑–∏–Ω–∞ - —Å–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω–æ
–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ code.gs - –≤—ã –ø—Ä–æ—Å–∏–ª–∏ —Ç–æ–ª—å–∫–æ ozon_functions.gs
‚úÖ –ü–†–ê–í–ò–õ–¨–ù–´–ô –ü–û–î–•–û–î:



–ò–ù–¢–ï–†–í–ê–õ–´ –¢–†–ò–ì–ì–ï–†–û–í
Google Apps Script –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ: 1, 5, 10, 15, 30 –º–∏–Ω—É—Ç


–ü—Ä–µ–¥–ª–∞–≥–∞—é: 30 –º–∏–Ω—É—Ç –¥–ª—è Ozon (—á–∞—â–µ —á–µ–º WB)
–ü—Ä–∏—á–∏–Ω–∞: Ozon API –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º, –Ω—É–∂–Ω–∞ –±–æ–ª–µ–µ —á–∞—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
2. –•–†–ê–ù–ï–ù–ò–ï –°–û–°–¢–û–Ø–ù–ò–Ø
–í–º–µ—Å—Ç–æ ScriptProperties –∏—Å–ø–æ–ª—å–∑—É–µ–º –ª–∏—Å—Ç—ã –º–∞–≥–∞–∑–∏–Ω–æ–≤:


–ö–æ–ª–æ–Ω–∫–∞ "–°—Ç–∞—Ç—É—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏": NEW, PROCESSED, SENT
–ö–æ–ª–æ–Ω–∫–∞ "ID –æ—Ç–∑—ã–≤–∞": –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
–ö–æ–ª–æ–Ω–∫–∞ "–î–∞—Ç–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏": –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
3. –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –ë–û–¢–û–í
–ë–û–¢ 1 (–°–ë–û–†–©–ò–ö): –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç
‚îú‚îÄ‚îÄ –°–æ–±–∏—Ä–∞–µ—Ç –Ω–æ–≤—ã–µ –æ—Ç–∑—ã–≤—ã Ozon
‚îú‚îÄ‚îÄ –§–∏–ª—å—Ç—Ä—É–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã –ø–æ ID –≤ –ª–∏—Å—Ç–µ
‚îú‚îÄ‚îÄ –î–æ–±–∞–≤–ª—è–µ—Ç –≤ –ª–∏—Å—Ç —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "NEW"
‚îî‚îÄ‚îÄ –û–±–Ω–æ–≤–ª—è–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å (–ø–æ—Å–ª–µ–¥–Ω—è—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞)


–ë–û–¢ 2 (–û–¢–ü–†–ê–í–©–ò–ö): –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç

‚îú‚îÄ‚îÄ –ò—â–µ—Ç –æ—Ç–∑—ã–≤—ã —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "NEW"
‚îú‚îÄ‚îÄ –ü–æ–¥–±–∏—Ä–∞–µ—Ç –æ—Ç–≤–µ—Ç—ã –∏–∑ –ª–∏—Å—Ç–∞ —à–∞–±–ª–æ–Ω–æ–≤
‚îú‚îÄ‚îÄ –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç–≤–µ—Ç—ã —á–µ—Ä–µ–∑ API
‚îî‚îÄ‚îÄ –ú–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å –Ω–∞ "SENT"
4. –°–ò–°–¢–ï–ú–ê –ü–†–û–ì–†–ï–°–°–ê
–•—Ä–∞–Ω–∏–º –≤ ScriptProperties —Ç–æ–ª—å–∫–æ –º–∏–Ω–∏–º—É–º:


// –ö–ª—é—á: ozon_progress_${storeId}
{
"lastPage": 15,           // –ü–æ—Å–ª–µ–¥–Ω—è—è –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
"lastCollectionTime": "2025-01-22T10:30:00Z",
"collectionStrategy": "incremental" // incremental/full_scan
}
üîß –ü–õ–ê–ù –†–ï–ê–õ–ò–ó–ê–¶–ò–ò –í OZON_FUNCTIONS.GS
–®–ê–ì 1: –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
// 1.1 –£–ª—É—á—à–∏—Ç—å getOzonFeedbacksWithAdaptivePagination
function getOzonFeedbacksWithAdaptivePagination(clientId, apiKey, includeAnswered, store) {
// –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –ø–æ –ª–∏—Å—Ç—É –º–∞–≥–∞–∑–∏–Ω–∞
// –î–æ–±–∞–≤–∏—Ç—å –ø–æ—ç—Ç–∞–ø–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ª–∏—Å—Ç
// –û–±–Ω–æ–≤–ª—è—Ç—å —Å—Ç–∞—Ç—É—Å –æ—Ç–∑—ã–≤–æ–≤
}


// 1.2 –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
function filterDuplicateOzonReviewsBySheet(reviews, storeId) {
// –ß–∏—Ç–∞–µ—Ç –ª–∏—Å—Ç –º–∞–≥–∞–∑–∏–Ω–∞
// –ü—Ä–æ–≤–µ—Ä—è–µ—Ç ID –æ—Ç–∑—ã–≤–æ–≤ –ø—Ä–æ—Ç–∏–≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö
// –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ –æ—Ç–∑—ã–≤—ã
}


// 1.3 –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –ø–æ—ç—Ç–∞–ø–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
function saveOzonReviewsToSheetIncremental(reviews, store) {
// –î–æ–±–∞–≤–ª—è–µ—Ç –æ—Ç–∑—ã–≤—ã –≤ –ª–∏—Å—Ç —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "NEW"
// –û–±–Ω–æ–≤–ª—è–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏
// –õ–æ–≥–∏—Ä—É–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–æ–≤—ã—Ö –æ—Ç–∑—ã–≤–æ–≤
}
–®–ê–ì 2: –°–æ–∑–¥–∞—Ç—å —Å–∏—Å—Ç–µ–º—É —Å—Ç–∞—Ç—É—Å–æ–≤
// 2.1 –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã —Å—Ç–∞—Ç—É—Å–æ–≤
const OZON_REVIEW_STATUS = {
NEW: 'NEW',           // –ù–æ–≤—ã–π –æ—Ç–∑—ã–≤, —Ç—Ä–µ–±—É–µ—Ç –æ—Ç–≤–µ—Ç–∞
PROCESSED: 'PROCESSED', // –û—Ç–≤–µ—Ç –ø–æ–¥–æ–±—Ä–∞–Ω, –≥–æ—Ç–æ–≤ –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ

SENT: 'SENT',         // –û—Ç–≤–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω
ERROR: 'ERROR'        // –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ
};


// 2.2 –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
function updateOzonReviewStatus(storeId, reviewId, status) {
// –ù–∞—Ö–æ–¥–∏—Ç –æ—Ç–∑—ã–≤ –≤ –ª–∏—Å—Ç–µ –ø–æ ID
// –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å
// –î–æ–±–∞–≤–ª—è–µ—Ç –¥–∞—Ç—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
}
–®–ê–ì 3: –°–æ–∑–¥–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
// 3.1 –£–ª—É—á—à–∏—Ç—å getStartingPageForStore
function getStartingPageForStore(store, includeAnswered) {
// –ò—Å–ø–æ–ª—å–∑—É–µ—Ç store.id –≤–º–µ—Å—Ç–æ store.name
// –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω—é—é –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
// –î–æ–±–∞–≤–ª—è–µ—Ç –ª–æ–≥–∏–∫—É –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ —Å–±–æ—Ä–∞
}


// 3.2 –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
function determineOzonCollectionStrategy(store) {
const progress = getOzonStoreProgress(store.id);
const now = new Date();
const lastCollection = progress.lastCollectionTime ? new Date(progress.lastCollectionTime) : null;


// –ï—Å–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Å–±–æ—Ä –±—ã–ª –±–æ–ª—å—à–µ 2 —á–∞—Å–æ–≤ –Ω–∞–∑–∞–¥ - –ø–æ–ª–Ω—ã–π —Å–∫–∞–Ω
if (!lastCollection || (now - lastCollection) > 2 * 60 * 60 * 1000) {
return 'full_scan';
}


// –ò–Ω–∞—á–µ - –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π —Å –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
return 'incremental';
}
üìä –ù–û–í–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    OZON –°–ò–°–¢–ï–ú–ê                            ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  –¢–†–ò–ì–ì–ï–† (–∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç)                                 ‚îÇ
‚îÇ  ‚Üì                                                          ‚îÇ
‚îÇ  getOzonFeedbacksWithAdaptivePagination()                  ‚îÇ
‚îÇ  ‚Üì                                                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ  –û–ü–†–ï–î–ï–õ–ï–ù–ò–ï –°–¢–†–ê–¢–ï–ì–ò–ò                                 ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚Üì incremental (—Å –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã)                  ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚Üì full_scan (–µ—Å–ª–∏ –ø—Ä–æ—à–ª–æ >2 —á–∞—Å–æ–≤)                   ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ  ‚Üì                                                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ  –°–ë–û–† –û–¢–ó–´–í–û–í –° –§–ò–õ–¨–¢–†–ê–¶–ò–ï–ô                            ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚Üì –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –ø–æ –ª–∏—Å—Ç—É –º–∞–≥–∞–∑–∏–Ω–∞              ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚Üì —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ –æ—Ç–∑—ã–≤—ã                                ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ  ‚Üì                                                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ  –ü–û–≠–¢–ê–ü–ù–û–ï –°–û–•–†–ê–ù–ï–ù–ò–ï                                 ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚Üì –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –ª–∏—Å—Ç —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "NEW"                ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚Üì –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ (–ø–æ—Å–ª–µ–¥–Ω—è—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞)          ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò


‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    –ë–û–¢ –û–¢–ü–†–ê–í–ö–ò                            ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  –¢–†–ò–ì–ì–ï–† (–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç)                                  ‚îÇ
‚îÇ  ‚Üì                                                          ‚îÇ
‚îÇ  processOzonAnswers()                                      ‚îÇ
‚îÇ  ‚Üì                                                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ  –ü–û–ò–°–ö –ù–û–í–´–• –û–¢–ó–´–í–û–í                                  ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚Üì –æ—Ç–∑—ã–≤—ã —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "NEW"                           ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ  ‚Üì                                                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ  –ü–û–î–ë–û–† –ò –û–¢–ü–†–ê–í–ö–ê –û–¢–í–ï–¢–û–í                            ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚Üì –≤—ã–±–æ—Ä —à–∞–±–ª–æ–Ω–∞ –∏–∑ –ª–∏—Å—Ç–∞                             ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ –æ—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ API                                 ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞ "SENT"                       ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
üéØ –ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê –ù–û–í–û–ì–û –ü–û–î–•–û–î–ê:
–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: –¢–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ –æ—Ç–∑—ã–≤—ã, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ª–∏—Å—Ç—É
–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å: –ü–æ—ç—Ç–∞–ø–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ, —Å—Ç–∞—Ç—É—Å—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏
–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å: –†–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –ª—é–±–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ—Ç–∑—ã–≤–æ–≤
–ü—Ä–æ—Å—Ç–æ—Ç–∞: –ò–∑–º–µ–Ω–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –≤ ozon_functions.gs
–û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å: –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ª–∏—Å—Ç–∞—Ö
üöÄ –ì–û–¢–û–í–´ –ù–ê–ß–ò–ù–ê–¢–¨?
–ü—Ä–µ–¥–ª–∞–≥–∞—é –Ω–∞—á–∞—Ç—å —Å –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ getOzonFeedbacksWithAdaptivePagination –≤ ozon_functions.gs:


–î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –ø–æ –ª–∏—Å—Ç—É
–î–æ–±–∞–≤–∏—Ç—å –ø–æ—ç—Ç–∞–ø–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ —Å—Ç–∞—Ç—É—Å–∞–º–∏
–£–ª—É—á—à–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
–•–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã —è:


–ü–æ–∫–∞–∑–∞–ª –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ ozon_functions.gs?
–°–æ–∑–¥–∞–ª –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è?
–ù–∞—á–∞–ª —Å –æ–¥–Ω–æ–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏?
–ö–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç–µ?


–≤–æ–∑–º–æ–∂–Ω–æ, –µ—Å—Ç—å —Å–º—ã—Å–ª —Ä–∞–∑–¥–µ–ª–∏—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä—ã –¥–ª—è –æ–∑–æ–Ω –∏ WB!
–≤ –≤–± –ø—Ä–∏—Ö–æ–¥—è—Ç , —è —Ç–∞–∫ –ø–æ–Ω—è–ª, –Ω–æ–≤—ã–µ. –≥–ª–∞–≤–Ω–æ–µ, —á—Ç–æ–±—ã —Ç–æ–∂–µ —Å–æ–±–∏—Ä–∞–ª –æ—Ç–∑—ã–≤—ã –∏ –≤–Ω–æ—Å–∏–ª –≤ —Ç–∞–±–ª–∏—Ü—É –∏ –¥—Ä—É–≥–æ–π –±–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–ª. - –≤–∞–∂–Ω–æ –≤ 6 –º–∏–Ω—É—Ç —Ä–∞–±–æ—Ç—ã —Ç—Ä–∏–≥–≥–µ—Ä–∞ —É–∫–ª–∞–¥—ã–≤–∞—Ç—å—Å—è.


—Ç–æ –µ—Å—Ç—å, –≤—Å—ë —Ç–æ–∂–µ —Å–∞–º–æ–µ, –Ω–æ —Ä–∞–∑–¥–µ–ª–∏—Ç—å, —á—Ç–æ–±—ã –Ω–µ –º–µ—à–∞—Ç—å. –¥–ª—è –í–ë –≤—Å–µ —ç—Ç–∏ –Ω–∞–≤–æ—Ä–æ—Ç—ã –Ω–µ –Ω—É–∂–Ω—ã!
‚îÇ  ‚Üì full_scan (–µ—Å–ª–∏ –ø—Ä–æ—à–ª–æ >2 —á–∞—Å–æ–≤ -  –∫–∞–∫-—Ç–æ –º–Ω–µ –Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è 2 —á–∞—Å–∞. –ú–æ–∂–Ω–æ –∏ —Ä–µ–∂–µ –∑–∞–ø—É—Å–∫–∞—Ç—å –ø–æ–ª–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ. –ü–æ–º–Ω–∏, —á—Ç–æ —É –Ω–∞—Å –µ—â—ë –µ—Å—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤—ã–±—Ä–∞—Ç—å –¥–∞—Ç—É –Ω–∞—á–∞–ª–∞ –ø–æ–∏—Å–∫–∞ (–≤ –º–µ–Ω—é), –≥–¥–µ –º—ã –≤—ã–±–∏—Ä–∞–µ–º —Å –∫–∞–∫–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ –æ—Ç–∑—ã–≤—ã –Ω—É–∂–Ω—ã. —Ç–æ –µ—Å—Ç—å , –µ—â—ë –∏ –Ω–µ –≤—Å–µ –Ω–µ–æ—Ç–≤–µ—á–µ–Ω–Ω—ã–µ –Ω—É–∂–Ω—ã.


–¢—É—Ç –º–æ–∂–Ω–æ –∏ –Ω–∞ —Ç—Ä–∏ —Ç—Ä–∏–≥–≥–µ—Ä–∞ —Ä–∞–∑–ª–æ–∂–∏—Ç—å!
NEW: 'NEW',      - 1 —Ç—Ä–∏–≥–≥–µ—Ä (–¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–∞—Ä–∫–µ—Ç –ø–ª–µ–π—Å–∞ —Å–≤–æ–π. 1 –¥–ª—è –æ–∑–æ–Ω —Ç–æ–ª—å–∫–æ, –≤—Ç–æ—Ä–æ–π —Ç–æ–ª—å–∫–æ –¥–ª—è WB) + –æ–Ω –∂–µ –∏—â–µ—Ç –¥—É–±–ª–∏ –≤ –ª–∏—Å—Ç–µ, –ø—Ä–∞–≤–∏–ª—å–Ω–æ?
PROCESSED: 'PROCESSED', - 2 —Ç—Ä–∏–≥–≥–µ—Ä (–º–æ–∂–µ—Ç –±—ã—Ç—å –æ–±—â–∏–º –¥–ª—è –≤—Å–µ—Ö –ø–ª–æ—â–∞–¥–æ–∫ –∏ –º–∞–≥–∞–∑–∏–Ω–æ–≤)
SENT: 'SENT',    - 3 —Ç—Ä–∏–≥–≥–µ—Ä  - —Ç–æ–∂–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–±—â–∏–º, –≥–ª–∞–≤–Ω–æ–µ –≤–µ–∑–¥–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã –∞–ø–∏ –∏—Å–ø–æ–ª–∑–æ–≤–∞—Ç—å!
ERROR: 'ERROR'   - –≤—Ö–æ–¥–∏—Ç –≤ –∫–∞–∂–¥—ã–π –∏–∑ —Ç—Ä—ë—Ö
–õ–û–≥–∏–∫–∞ –≤ —á—ë–º.


–ì–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ –Ω–æ–º–µ—Ä –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã?


–í –æ–±—â–µ–º, –Ω–∞–¥—ë–∂–Ω–æ –≤—Å—ë –¥–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö. –ß—Ç–æ–±—ã –º—ã —Å–≤–µ–ª–∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –∫ –Ω—É–ª—é –ø–æ—Ç–µ—Ä–∏ –æ—Ç–∑—ã–≤–æ–≤ –∏ –Ω–µ –æ—Ç–≤–µ—á–∞–ª–∏ –Ω–∞ –Ω–∏—Ö –¥–≤–∞–∂–¥—ã.


getOzonFeedbacksWithAdaptivePagination - —á—Ç–æ –∑–∞ —É–∂–∞—Å–Ω–æ –¥–ª–∏–Ω–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π????
–û—Ç–ª–∏—á–Ω–æ! –í—ã –∞–±—Å–æ–ª—é—Ç–Ω–æ –ø—Ä–∞–≤—ã! –î–∞–≤–∞–π—Ç–µ —É–ø—Ä–æ—Å—Ç–∏–º –∏ —Å–¥–µ–ª–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ:


üéØ –£–ü–†–û–©–ï–ù–ù–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê 3 –¢–†–ò–ì–ì–ï–†–û–í
üìä –†–ê–ó–î–ï–õ–ï–ù–ò–ï –¢–†–ò–ì–ì–ï–†–û–í:
–¢–†–ò–ì–ì–ï–† 1: –°–ë–û–† –û–¢–ó–´–í–û–í (–∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç)
‚îú‚îÄ‚îÄ WB: processWbReviews() - –ø—Ä–æ—Å—Ç–æ–π —Å–±–æ—Ä –Ω–æ–≤—ã—Ö
‚îú‚îÄ‚îÄ Ozon: processOzonReviews() - —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
‚îî‚îÄ‚îÄ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –ª–∏—Å—Ç—ã —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "NEW"


–¢–†–ò–ì–ì–ï–† 2: –ü–û–î–ë–û–† –û–¢–í–ï–¢–û–í (–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç)

‚îú‚îÄ‚îÄ –ò—â–µ—Ç –æ—Ç–∑—ã–≤—ã —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "NEW"
‚îú‚îÄ‚îÄ –ü–æ–¥–±–∏—Ä–∞–µ—Ç –æ—Ç–≤–µ—Ç—ã –∏–∑ —à–∞–±–ª–æ–Ω–æ–≤
‚îî‚îÄ‚îÄ –ú–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å –Ω–∞ "PROCESSED"


–¢–†–ò–ì–ì–ï–† 3: –û–¢–ü–†–ê–í–ö–ê –û–¢–í–ï–¢–û–í (–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç)
‚îú‚îÄ‚îÄ –ò—â–µ—Ç –æ—Ç–∑—ã–≤—ã —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "PROCESSED"
‚îú‚îÄ‚îÄ –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —á–µ—Ä–µ–∑ API
‚îî‚îÄ‚îÄ –ú–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å –Ω–∞ "SENT"
üîß –•–†–ê–ù–ï–ù–ò–ï –°–û–°–¢–û–Ø–ù–ò–Ø –í –¢–ê–ë–õ–ò–¶–ê–•:
–ö–æ–ª–æ–Ω–∫–∏ –≤ –ª–∏—Å—Ç–∞—Ö –º–∞–≥–∞–∑–∏–Ω–æ–≤:
A: ID –æ—Ç–∑—ã–≤–∞
B: –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è

C: –†–µ–π—Ç–∏–Ω–≥
D: –¢–µ–∫—Å—Ç –æ—Ç–∑—ã–≤–∞
E: –¢–æ–≤–∞—Ä
F: –°—Ç–∞—Ç—É—Å (NEW/PROCESSED/SENT/ERROR)
G: –î–∞—Ç–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏
H: –û—Ç–≤–µ—Ç (–µ—Å–ª–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω)
I: –û—à–∏–±–∫–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å)
–ü—Ä–æ–≥—Ä–µ—Å—Å –≤ ScriptProperties (–º–∏–Ω–∏–º—É–º):
// –ö–ª—é—á: progress_${storeId}
{
"lastPage": 15,
"lastCollection": "2025-01-22T10:30:00Z",
"strategy": "incremental" // incremental/full
}
üöÄ –ü–õ–ê–ù –†–ï–ê–õ–ò–ó–ê–¶–ò–ò –í OZON_FUNCTIONS.GS:
–®–ê–ì 1: –£–ø—Ä–æ—Å—Ç–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π
// –í–º–µ—Å—Ç–æ getOzonFeedbacksWithAdaptivePagination
function getOzonReviews(clientId, apiKey, includeAnswered, store) {
// –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å–±–æ—Ä–∞ –æ—Ç–∑—ã–≤–æ–≤
}


// –í–º–µ—Å—Ç–æ getOzonFeedbacksWithStandardPagination

function getOzonReviewsSimple(clientId, apiKey, includeAnswered, store) {
// –ü—Ä–æ—Å—Ç–∞—è –≤–µ—Ä—Å–∏—è –±–µ–∑ –∞–¥–∞–ø—Ç–∞—Ü–∏–∏
}


// –í–º–µ—Å—Ç–æ processFeedbacksPageForOzon
function processOzonPage(reviews) {
// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –æ—Ç–∑—ã–≤–æ–≤
}
–®–ê–ì 2: –°–æ–∑–¥–∞—Ç—å —Å–∏—Å—Ç–µ–º—É —Å—Ç–∞—Ç—É—Å–æ–≤
// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã —Å—Ç–∞—Ç—É—Å–æ–≤
const REVIEW_STATUS = {
NEW: 'NEW',
PROCESSED: 'PROCESSED',
SENT: 'SENT',
ERROR: 'ERROR'
};


// –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
function updateReviewStatus(storeId, reviewId, status, error = null) {
const sheet = getStoreSheet(storeId);
const data = sheet.getDataRange().getValues();


for (let i = 1; i < data.length; i++) {
if (data[i][0] === reviewId) { // ID –≤ –∫–æ–ª–æ–Ω–∫–µ A
sheet.getRange(i + 1, 6).setValue(status); // –°—Ç–∞—Ç—É—Å –≤ –∫–æ–ª–æ–Ω–∫–µ F
sheet.getRange(i + 1, 7).setValue(new Date()); // –î–∞—Ç–∞ –≤ –∫–æ–ª–æ–Ω–∫–µ G
if (error) {
sheet.getRange(i + 1, 9).setValue(error); // –û—à–∏–±–∫–∞ –≤ –∫–æ–ª–æ–Ω–∫–µ I
}
break;
}
}
}
–®–ê–ì 3: –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç—Ä–∏–≥–≥–µ—Ä–∞
// –¢–†–ò–ì–ì–ï–† 1: –°–±–æ—Ä –æ—Ç–∑—ã–≤–æ–≤ Ozon
function processOzonReviews() {
const stores = getOzonStores(); // –¢–æ–ª—å–∫–æ Ozon –º–∞–≥–∞–∑–∏–Ω—ã


stores.forEach(store => {
if (!store.isActive) return;


log(`[Ozon Collector] –û–±—Ä–∞–±–æ—Ç–∫–∞ ${store.name}...`);

// –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç—Ä–∞—Ç–µ–≥–∏—é
const strategy = getCollectionStrategy(store);
log(`[Ozon Collector] –°—Ç—Ä–∞—Ç–µ–≥–∏—è: ${strategy}`);

// –°–æ–±–∏—Ä–∞–µ–º –æ—Ç–∑—ã–≤—ã
const reviews = collectOzonReviews(store, strategy);

if (reviews.length > 0) {
  // –§–∏–ª—å—Ç—Ä—É–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã –ø–æ –ª–∏—Å—Ç—É
  const newReviews = filterDuplicatesBySheet(reviews, store.id);
  
  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ª–∏—Å—Ç —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º NEW
  saveReviewsToSheet(newReviews, store.id, REVIEW_STATUS.NEW);
  
  log(`[Ozon Collector] –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ ${newReviews.length} –Ω–æ–≤—ã—Ö –æ—Ç–∑—ã–≤–æ–≤`);
} else {
  log(`[Ozon Collector] –ù–æ–≤—ã—Ö –æ—Ç–∑—ã–≤–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ`);
}

});
}


// –¢–†–ò–ì–ì–ï–† 2: –ü–æ–¥–±–æ—Ä –æ—Ç–≤–µ—Ç–æ–≤ (–æ–±—â–∏–π –¥–ª—è –≤—Å–µ—Ö)
function processReviewAnswers() {
const stores = getAllActiveStores();


stores.forEach(store => {
const newReviews = getReviewsByStatus(store.id, REVIEW_STATUS.NEW);


if (newReviews.length === 0) return;

log(`[Answer Processor] –û–±—Ä–∞–±–æ—Ç–∫–∞ ${newReviews.length} –æ—Ç–∑—ã–≤–æ–≤ –¥–ª—è ${store.name}`);

newReviews.forEach(review => {
  try {
    // –ü–æ–¥–±–∏—Ä–∞–µ–º –æ—Ç–≤–µ—Ç
    const answer = selectAnswerTemplate(review, store);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
    updateReviewStatus(store.id, review.id, REVIEW_STATUS.PROCESSED);
    
    log(`[Answer Processor] –û—Ç–≤–µ—Ç –ø–æ–¥–æ–±—Ä–∞–Ω –¥–ª—è –æ—Ç–∑—ã–≤–∞ ${review.id}`);
  } catch (error) {
    updateReviewStatus(store.id, review.id, REVIEW_STATUS.ERROR, error.message);
    log(`[Answer Processor] –û—à–∏–±–∫–∞: ${error.message}`);
  }
});

});
}


// –¢–†–ò–ì–ì–ï–† 3: –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤ (–æ–±—â–∏–π –¥–ª—è –≤—Å–µ—Ö)
function processReviewSending() {
const stores = getAllActiveStores();


stores.forEach(store => {
const processedReviews = getReviewsByStatus(store.id, REVIEW_STATUS.PROCESSED);


if (processedReviews.length === 0) return;

log(`[Answer Sender] –û—Ç–ø—Ä–∞–≤–∫–∞ ${processedReviews.length} –æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è ${store.name}`);

processedReviews.forEach(review => {
  try {
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç —á–µ—Ä–µ–∑ API
    const success = sendAnswerToReview(review, store);
    
    if (success) {
      updateReviewStatus(store.id, review.id, REVIEW_STATUS.SENT);
      log(`[Answer Sender] –û—Ç–≤–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –¥–ª—è –æ—Ç–∑—ã–≤–∞ ${review.id}`);
    } else {
      updateReviewStatus(store.id, review.id, REVIEW_STATUS.ERROR, '–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏');
    }
  } catch (error) {
    updateReviewStatus(store.id, review.id, REVIEW_STATUS.ERROR, error.message);
    log(`[Answer Sender] –û—à–∏–±–∫–∞: ${error.message}`);
  }
});

});
}
–®–ê–ì 4: –°–æ–∑–¥–∞—Ç—å –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
// –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Å–±–æ—Ä–∞
function getCollectionStrategy(store) {
const progress = getStoreProgress(store.id);
const now = new Date();
const lastCollection = progress.lastCollection ? new Date(progress.lastCollection) : null;


// –ï—Å–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Å–±–æ—Ä –±—ã–ª –±–æ–ª—å—à–µ 6 —á–∞—Å–æ–≤ –Ω–∞–∑–∞–¥ - –ø–æ–ª–Ω—ã–π —Å–∫–∞–Ω
if (!lastCollection || (now - lastCollection) > 6 * 60 * 60 * 1000) {
return 'full';
}


// –ò–Ω–∞—á–µ - –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π —Å –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
return 'incremental';
}


// –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –ø–æ –ª–∏—Å—Ç—É
function filterDuplicatesBySheet(reviews, storeId) {
const sheet = getStoreSheet(storeId);
const data = sheet.getDataRange().getValues();
const existingIds = new Set();


// –°–æ–±–∏—Ä–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ ID
for (let i = 1; i < data.length; i++) {
existingIds.add(data[i][0]); // ID –≤ –∫–æ–ª–æ–Ω–∫–µ A
}


// –§–∏–ª—å—Ç—Ä—É–µ–º –Ω–æ–≤—ã–µ –æ—Ç–∑—ã–≤—ã
return reviews.filter(review => !existingIds.has(review.id));
}


// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ç–∑—ã–≤–æ–≤ –≤ –ª–∏—Å—Ç
function saveReviewsToSheet(reviews, storeId, status) {
const sheet = getStoreSheet(storeId);
const now = new Date();


reviews.forEach(review => {
sheet.appendRow([
review.id,                    // A: ID –æ—Ç–∑—ã–≤–∞
review.createdDate,           // B: –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
review.rating,                // C: –†–µ–π—Ç–∏–Ω–≥
review.text,                  // D: –¢–µ–∫—Å—Ç –æ—Ç–∑—ã–≤–∞
review.product.name,          // E: –¢–æ–≤–∞—Ä
status,                       // F: –°—Ç–∞—Ç—É—Å
now,                          // G: –î–∞—Ç–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏
'',                           // H: –û—Ç–≤–µ—Ç (–ø—É—Å—Ç–æ–π)
''                            // I: –û—à–∏–±–∫–∞ (–ø—É—Å—Ç–∞—è)
]);
});
}
üéØ –ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê –ù–û–í–û–ì–û –ü–û–î–•–û–î–ê:
–ü—Ä–æ—Å—Ç–æ—Ç–∞: 3 –ø–æ–Ω—è—Ç–Ω—ã—Ö —Ç—Ä–∏–≥–≥–µ—Ä–∞ –≤–º–µ—Å—Ç–æ —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–∏
–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å: –í—Å–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö, –Ω–∏–∫–∞–∫–∏—Ö –ø–æ—Ç–µ—Ä—å
–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –ø–æ –ª–∏—Å—Ç—É
–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å: –†–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –ª—é–±–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –º–∞–≥–∞–∑–∏–Ω–æ–≤
–û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å: –ö–∞–∂–¥—ã–π —ç—Ç–∞–ø –Ω–µ–∑–∞–≤–∏—Å–∏–º
üöÄ –ì–û–¢–û–í–´ –ù–ê–ß–ò–ù–ê–¢–¨?
–ü—Ä–µ–¥–ª–∞–≥–∞—é –Ω–∞—á–∞—Ç—å —Å —Å–æ–∑–¥–∞–Ω–∏—è –±–∞–∑–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –≤ ozon_functions.gs:


–£–ø—Ä–æ—Å—Ç–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π
–°–æ–∑–¥–∞—Ç—å —Å–∏—Å—Ç–µ–º—É —Å—Ç–∞—Ç—É—Å–æ–≤
–°–æ–∑–¥–∞—Ç—å 3 –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤
–•–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã —è:


–ü–æ–∫–∞–∑–∞–ª –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ ozon_functions.gs?
–°–æ–∑–¥–∞–ª –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å–∏—Å—Ç–µ–º—ã —Å—Ç–∞—Ç—É—Å–æ–≤?
–ù–∞—á–∞–ª —Å –æ–¥–Ω–æ–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏?
–ö–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç–µ?


üîß –•–†–ê–ù–ï–ù–ò–ï –°–û–°–¢–û–Ø–ù–ò–Ø –í –¢–ê–ë–õ–ò–¶–ê–•:
–ö–æ–ª–æ–Ω–∫–∏ –≤ –ª–∏—Å—Ç–∞—Ö –º–∞–≥–∞–∑–∏–Ω–æ–≤:
A: ID –æ—Ç–∑—ã–≤–∞
B: –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è

C: –†–µ–π—Ç–∏–Ω–≥
D: –¢–µ–∫—Å—Ç –æ—Ç–∑—ã–≤–∞
E: –¢–æ–≤–∞—Ä
F: –°—Ç–∞—Ç—É—Å (NEW/PROCESSED/SENT/ERROR)
G: –î–∞—Ç–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏
H: –û—Ç–≤–µ—Ç (–µ—Å–ª–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω)
I: –û—à–∏–±–∫–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å)


–Ω–∞–¥–æ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —É –Ω–∞—Å –ª–∏—Å—Ç—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ!


// –í–º–µ—Å—Ç–æ getOzonFeedbacksWithAdaptivePagination
function getOzonReviews(clientId, apiKey, includeAnswered, store) {
// –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å–±–æ—Ä–∞ –æ—Ç–∑—ã–≤–æ–≤
} - –±–µ–∑ —Ñ–∞–Ω–∞—Ç–∏–∑–º–∞! —Ç–ª—å–∫–æ –≤–æ—Ç —ç—Ç—É –¥–ª–∏–Ω–Ω—é—â—É—é –ø–µ—Ä–µ–∏–º–µ–Ω—É–π! –∏ –æ—Ç—Å–ª–µ–¥–∏, —á—Ç–æ –º—ã –µ—ë –Ω–µ –ø–æ—Ç–µ—Ä—è–µ–º –≤ –∫–æ–¥–µ!
–±–∞–∑–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –≤ ozon_functions.gs: - –¥–∞, –Ω–æ –¥–ª—è –í–± —Ç–æ–∂–µ –Ω–∞–¥–æ. –¥–ª—è –Ω–∏—Ö –≥–¥–µ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è? –ø–æ –∏–¥–µ–µ, —Ç—Ä–∏–≥–µ—Ä—ã –º–æ–∂–Ω–æ –∏ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –∫–æ–¥–µ. –∞ –≤–æ—Ç –ª–æ–≥–∏–∫—É —Å–∞–º–æ–π —Ä–∞–±–æ—Ç—ã —Å –æ–∑–æ–Ω –æ—Å—Ç–∞–≤–∏—Ç—å –≤ –æ–∑–æ–Ω_—Ñ—É–Ω–∫—à. –ö–∞–∫ —Å—á–∏—Ç–∞–µ—à—å?
–û—Ç–ª–∏—á–Ω–æ! –î–∞–≤–∞–π—Ç–µ —Ä–∞–∑–±–µ—Ä–µ–º –ø–æ –ø—É–Ω–∫—Ç–∞–º:


üîç 1. –ü–†–û–í–ï–†–ö–ê –°–¢–†–£–ö–¢–£–†–´ –õ–ò–°–¢–û–í
–°–Ω–∞—á–∞–ª–∞ –ø–æ—Å–º–æ—Ç—Ä–∏–º, –∫–∞–∫ —Å–µ–π—á–∞—Å —Å–æ–∑–¥–∞—é—Ç—Å—è –ª–∏—Å—Ç—ã:


Searched and read code.gs
–í–∏–∂—É –ø—Ä–æ–±–ª–µ–º—É! –¢–µ–∫—É—â–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –Ω–∞—à–µ–π –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ. –î–∞–≤–∞–π—Ç–µ –∏—Å–ø—Ä–∞–≤–∏–º:


üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –°–¢–†–£–ö–¢–£–†–´ –õ–ò–°–¢–û–í
–¢–µ–∫—É—â–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏:
HEADERS: ['‚Ññ', 'ID –æ—Ç–∑—ã–≤–∞', '–î–∞—Ç–∞ –æ—Ç–∑—ã–≤–∞', '–ê—Ä—Ç–∏–∫—É–ª', '–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞', '–°—Å—ã–ª–∫–∞', '–û—Ü–µ–Ω–∫–∞', '–¢–µ–∫—Å—Ç –æ—Ç–∑—ã–≤–∞', '–°—Ç–∞—Ç—É—Å', '–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏', '–í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏']
–ù–æ–≤—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ (—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –Ω–∞—à–µ–π —Å—Ö–µ–º–µ):
HEADERS: ['ID –æ—Ç–∑—ã–≤–∞', '–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è', '–†–µ–π—Ç–∏–Ω–≥', '–¢–µ–∫—Å—Ç –æ—Ç–∑—ã–≤–∞', '–¢–æ–≤–∞—Ä', '–°—Ç–∞—Ç—É—Å', '–î–∞—Ç–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏', '–û—Ç–≤–µ—Ç', '–û—à–∏–±–∫–∞']
üîç 2. –ü–†–û–í–ï–†–ö–ê –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø –î–õ–ò–ù–ù–û–ô –§–£–ù–ö–¶–ò–ò
Searched twice
–û—Ç–ª–∏—á–Ω–æ! –§—É–Ω–∫—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ code.gs —á–µ—Ä–µ–∑ –æ–±–µ—Ä—Ç–∫—É getOzonFeedbacks. –ü–µ—Ä–µ–∏–º–µ–Ω—É–µ–º –µ–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ.


üéØ 3. –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –†–ê–ó–î–ï–õ–ï–ù–ò–Ø
–í—ã –ø—Ä–∞–≤—ã! –õ–æ–≥–∏—á–Ω–æ —Ä–∞–∑–¥–µ–ª–∏—Ç—å —Ç–∞–∫:


code.gs:
–¢—Ä–∏–≥–≥–µ—Ä—ã (3 —à—Ç—É–∫–∏)
–û–±—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ (WB + Ozon)
–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞–º–∏
–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–∏—Å—Ç–æ–≤
ozon_functions.gs:
–¢–æ–ª—å–∫–æ –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å Ozon API
–°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è Ozon
api_fixes.gs:
–¢–æ–ª—å–∫–æ –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å WB API
–°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è WB
üöÄ –ü–õ–ê–ù –†–ï–ê–õ–ò–ó–ê–¶–ò–ò
–®–ê–ì 1: –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ª–∏—Å—Ç–æ–≤ –≤ code.gs
// –í CONFIG –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏
HEADERS: ['ID –æ—Ç–∑—ã–≤–∞', '–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è', '–†–µ–π—Ç–∏–Ω–≥', '–¢–µ–∫—Å—Ç –æ—Ç–∑—ã–≤–∞', '–¢–æ–≤–∞—Ä', '–°—Ç–∞—Ç—É—Å', '–î–∞—Ç–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏', '–û—Ç–≤–µ—Ç', '–û—à–∏–±–∫–∞'],


// –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Å—Ç–∞—Ç—É—Å—ã
STATUS: {
NEW: 'NEW',
PROCESSED: 'PROCESSED',
SENT: 'SENT',
ERROR: 'ERROR'
}
–®–ê–ì 2: –°–æ–∑–¥–∞—Ç—å 3 —Ç—Ä–∏–≥–≥–µ—Ä–∞ –≤ code.gs
// –¢–†–ò–ì–ì–ï–† 1: –°–±–æ—Ä –æ—Ç–∑—ã–≤–æ–≤ (–∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç)
function processReviewsCollection() {
// WB: –ø—Ä–æ—Å—Ç–æ–π —Å–±–æ—Ä
processWbReviews();


// Ozon: —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

processOzonReviews();
}


// –¢–†–ò–ì–ì–ï–† 2: –ü–æ–¥–±–æ—Ä –æ—Ç–≤–µ—Ç–æ–≤ (–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç)
function processReviewAnswers() {
// –û–±—â–∏–π –¥–ª—è –≤—Å–µ—Ö –º–∞–≥–∞–∑–∏–Ω–æ–≤
processAnswersForAllStores();
}


// –¢–†–ò–ì–ì–ï–† 3: –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤ (–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç)

function processReviewSending() {
// –û–±—â–∏–π –¥–ª—è –≤—Å–µ—Ö –º–∞–≥–∞–∑–∏–Ω–æ–≤
processSendingForAllStores();
}
–®–ê–ì 3: –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –≤ ozon_functions.gs
// –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å getOzonFeedbacksWithAdaptivePagination
function getOzonReviews(clientId, apiKey, includeAnswered, store) {
// –¢–æ—Ç –∂–µ –∫–æ–¥, –Ω–æ —Å –Ω–æ–≤—ã–º –∏–º–µ–Ω–µ–º
}


// –û–±–Ω–æ–≤–∏—Ç—å –≤—ã–∑–æ–≤ –≤ code.gs
function getOzonFeedbacks(clientId, apiKey, includeAnswered = false, store = null) {
// ...
return getOzonReviews(clientId, apiKey, includeAnswered, store);
}
–®–ê–ì 4: –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è WB –≤ api_fixes.gs
// –ê–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è WB
function processWbReviews() {
// –ü—Ä–æ—Å—Ç–æ–π —Å–±–æ—Ä WB –æ—Ç–∑—ã–≤–æ–≤
}


function getWbReviews(apiKey, includeAnswered, store) {
// –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å–±–æ—Ä–∞ WB –æ—Ç–∑—ã–≤–æ–≤
}
üéØ –ì–û–¢–û–í–´ –ù–ê–ß–ò–ù–ê–¢–¨?
–ü—Ä–µ–¥–ª–∞–≥–∞—é –Ω–∞—á–∞—Ç—å —Å –®–ê–ì–ê 1 - –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ª–∏—Å—Ç–æ–≤:


–ò–∑–º–µ–Ω–∏—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏ –≤ CONFIG
–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Å—Ç–∞—Ç—É—Å—ã
–û–±–Ω–æ–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é createOrGetSheet
–•–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã —è:


–ü–æ–∫–∞–∑–∞–ª –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ code.gs?
–°–æ–∑–¥–∞–ª –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤?
–ù–∞—á–∞–ª —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ª–∏—Å—Ç–æ–≤?
–ö–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç–µ?


–¥–∞. –ø—Ä–∏—Å—Ç—É–ø–∞–π –∫ –ø–æ–ª–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏. –ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π –∑–∞–ø—É—à –Ω–∞ –≥–∏—Ç—Ö–∞–± —Ç–æ–ª—å–∫–æ –ø—Ä–µ–≤–¥–∞—Ä–∏—Ç–µ–ª—å–Ω–æ
–û—Ç–ª–∏—á–Ω–æ! –ü—Ä–∏—Å—Ç—É–ø–∞—é –∫ –ø–æ–ª–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏. –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–º –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π –∏ –∑–∞–ø—É—à—É –µ–≥–æ –Ω–∞ GitHub.
